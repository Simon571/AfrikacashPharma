"use strict";(()=>{var e={};e.id=7342,e.ids=[3220,7342],e.modules={8732:e=>{e.exports=require("react/jsx-runtime")},15806:e=>{e.exports=require("next-auth/next")},33873:e=>{e.exports=require("path")},40361:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},43197:(e,r,s)=>{s.d(r,{N:()=>o});let t=require("next-auth/providers/credentials");var a=s.n(t);let n=require("bcryptjs");var l=s.n(n),i=s(79943);let d=[{id:"admin-1",username:"admin",password:"Admin123!",role:"admin"},{id:"seller-1",username:"vendeur",password:"vendeur123",role:"seller"},{id:"superadmin-1",username:"superadmin",password:"SuperAdmin123!",role:"admin"}],o={providers:[a()({name:"Credentials",credentials:{username:{label:"Username",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(console.log("\uD83D\uDD10 authorize() appel\xe9 avec credentials:",{username:e?.username,password:e?.password?"***":"undefined"}),!e?.username||!e.password)return console.log("❌ Credentials manquants"),null;let r=e.username.trim(),s=String(e.password).trim();try{try{console.log("\uD83D\uDD0D Recherche de l'utilisateur dans Prisma:",r);let e=await Promise.race([i.z.user.findUnique({where:{username:r}}),new Promise((e,r)=>setTimeout(()=>r(Error("Timeout BD")),5e3))]);if(e){console.log("✅ Utilisateur trouv\xe9 dans Prisma");let r=await l().compare(s,e.passwordHash);if(console.log("\uD83D\uDD11 V\xe9rification du mot de passe Prisma:",r?"✅ OK":"❌ FAIL"),r){let r={id:e.id,name:e.username,role:e.role};return console.log("✅ Authentification Prisma r\xe9ussie"),r}}else console.log("ℹ️ Utilisateur non trouv\xe9 dans Prisma, essai des utilisateurs par d\xe9faut")}catch(e){console.warn("⚠️ Erreur Prisma, utilisation des utilisateurs par d\xe9faut:",e)}console.log("\uD83D\uDD0D Recherche de l'utilisateur dans les utilisateurs par d\xe9faut");let e=d.find(e=>e.username===r);if(!e)return console.log("❌ Utilisateur non trouv\xe9:",r),null;console.log("✅ Utilisateur trouv\xe9 dans les utilisateurs par d\xe9faut");let t=e.password===s;if(console.log("\uD83D\uDD11 V\xe9rification du mot de passe (direct):",t?"✅ OK":"❌ FAIL"),!t)return console.log("❌ Mot de passe invalide"),null;let a={id:e.id,name:e.username,role:e.role};return console.log("✅ Authentification r\xe9ussie (utilisateur par d\xe9faut)"),a}catch(e){return console.error("❌ Erreur dans authorize():",e),null}}})],session:{strategy:"jwt"},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.username=r.name||r.username,e.role=r.role),e),session:async({session:e,token:r})=>(e.user&&(e.user.id=r.id,e.user.username=r.username,e.user.role=r.role),e)},pages:{signIn:"/login"},secret:process.env.NEXTAUTH_SECRET,debug:!0}},79943:(e,r,s)=>{s.d(r,{z:()=>a});var t=s(96330);let a=global.__prismaClient__??new t.PrismaClient},82015:e=>{e.exports=require("react")},90659:(e,r,s)=>{s.r(r),s.d(r,{config:()=>k,default:()=>F,getServerSideProps:()=>C,getStaticPaths:()=>A,getStaticProps:()=>M,reportWebVitals:()=>q,routeModule:()=>R,unstable_getServerProps:()=>T,unstable_getServerSideProps:()=>E,unstable_getStaticParams:()=>_,unstable_getStaticPaths:()=>D,unstable_getStaticProps:()=>U});var t={};s.r(t),s.d(t,{default:()=>S,getServerSideProps:()=>P});var a=s(63885),n=s(80237),l=s(81413),i=s(58548),d=s.n(i),o=s(19380),u=s.n(o),c=s(8732),m=s(15806),p=s(43197),x=s(82015),g=s(77419),h=s(56732);let b=(0,h.A)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),j=(0,h.A)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),f=(0,h.A)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]),v=(0,h.A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);function y(){let[e,r]=(0,x.useState)(null),[s,t]=(0,x.useState)(""),[a,n]=(0,x.useState)(!0),[l,i]=(0,x.useState)(!1),[d,o]=(0,x.useState)(null),[u,m]=(0,x.useState)(0),[p,h]=(0,x.useState)(null),y=async()=>{try{let e=parseFloat(s);if(!e||e<=0)return void h({type:"error",text:"Le taux doit \xeatre un nombre positif"});i(!0);let t=await fetch("/api/exchange-rate",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({rate:e})});if(!t.ok){let e=await t.json();throw Error(e.message||"Erreur lors de la mise \xe0 jour")}let a=await t.json();a.medicationsUpdated&&(m(a.medicationsUpdated),r(e),o(new Date),h({type:"success",text:`Taux mis \xe0 jour! ${a.medicationsUpdated} m\xe9dicaments recalcul\xe9s`}))}catch(e){console.error("Erreur:",e),h({type:"error",text:e.message||"Erreur lors de la mise \xe0 jour"})}finally{i(!1)}},N=e&&parseFloat(s)?parseFloat(s)-e:0,w=e&&0!==N?(N/e*100).toFixed(2):"0";return a?(0,c.jsx)("div",{className:"w-full bg-white rounded-lg border p-6",children:(0,c.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,c.jsx)(g.A,{className:"h-6 w-6 animate-spin"})})}):(0,c.jsxs)("div",{className:"w-full bg-white rounded-lg border p-6 space-y-6",children:[(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[(0,c.jsx)(b,{className:"h-5 w-5"}),"Taux de Change USD → CDF"]}),(0,c.jsx)("p",{className:"text-gray-600",children:"G\xe9rez le taux de change pour la conversion automatique des prix"})]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,c.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg border border-blue-200",children:[(0,c.jsx)("p",{className:"text-sm text-blue-600 mb-1",children:"Taux Actuel"}),(0,c.jsxs)("p",{className:"text-3xl font-bold text-blue-900",children:[e?.toLocaleString()," CDF"]}),(0,c.jsx)("p",{className:"text-xs text-blue-500 mt-2",children:"1 USD"})]}),(0,c.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg border border-green-200",children:[(0,c.jsx)("p",{className:"text-sm text-green-600 mb-1",children:"M\xe9dicaments Affect\xe9s"}),(0,c.jsx)("p",{className:"text-3xl font-bold text-green-900",children:u}),(0,c.jsx)("p",{className:"text-xs text-green-500 mt-2",children:"Convertis avec ce taux"})]}),(0,c.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg border border-purple-200",children:[(0,c.jsx)("p",{className:"text-sm text-purple-600 mb-1",children:"Derni\xe8re Mise \xe0 Jour"}),(0,c.jsx)("p",{className:"text-sm font-mono text-purple-900",children:d?.toLocaleDateString("fr-FR")}),(0,c.jsx)("p",{className:"text-xs text-purple-500 mt-2",children:d?.toLocaleTimeString("fr-FR")})]})]}),(0,c.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 space-y-4",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"newRate",className:"block text-sm font-medium mb-2",children:"Nouveau Taux (CDF/USD)"}),(0,c.jsxs)("div",{className:"flex gap-2",children:[(0,c.jsx)("input",{id:"newRate",type:"number",step:"0.01",value:s,onChange:e=>t(e.target.value),placeholder:"Entrez le nouveau taux",disabled:l,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md"}),(0,c.jsxs)("button",{onClick:y,disabled:l||!s,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-md flex items-center gap-2",children:[l?(0,c.jsx)(g.A,{className:"h-4 w-4 animate-spin"}):null,"Mettre \xe0 Jour"]})]})]}),0!==N&&(0,c.jsx)("div",{className:"flex items-center gap-2 text-sm",children:N>0?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(j,{className:"h-4 w-4 text-green-600"}),(0,c.jsxs)("span",{className:"text-green-600",children:["+",N.toFixed(2)," CDF (",w,"%)"]})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(f,{className:"h-4 w-4 text-red-600"}),(0,c.jsxs)("span",{className:"text-red-600",children:[N.toFixed(2)," CDF (",w,"%)"]})]})})]}),p&&(0,c.jsx)("div",{className:"success"===p.type?"bg-green-50 border border-green-200 p-4 rounded-lg":"bg-red-50 border border-red-200 p-4 rounded-lg",children:(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)(v,{className:"success"===p.type?"h-4 w-4 text-green-600":"h-4 w-4 text-red-600"}),(0,c.jsx)("p",{className:"success"===p.type?"text-green-800":"text-red-800",children:p.text})]})}),(0,c.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,c.jsxs)("p",{className:"text-sm text-blue-900",children:[(0,c.jsx)("strong",{children:"Info:"})," Quand vous mettez \xe0 jour le taux, tous les prix en CDF des produits seront recalcul\xe9s automatiquement en fonction de leurs prix USD de r\xe9f\xe9rence."]})})]})}var N=s(49788),w=s.n(N);function S(){return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(w(),{children:(0,c.jsx)("title",{children:"Gestion du Taux de Change | AfrikaPharma"})}),(0,c.jsx)("div",{className:"min-h-screen bg-gray-100 p-8",children:(0,c.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,c.jsx)(y,{})})})]})}let P=async e=>{let r=await (0,m.getServerSession)(e.req,e.res,p.N);return r?r.user?.role!=="admin"?{notFound:!0}:{props:{session:r}}:{redirect:{destination:`/login-admin?callbackUrl=${encodeURIComponent("/admin/exchange-rate")}`,permanent:!1}}},F=(0,l.M)(t,"default"),M=(0,l.M)(t,"getStaticProps"),A=(0,l.M)(t,"getStaticPaths"),C=(0,l.M)(t,"getServerSideProps"),k=(0,l.M)(t,"config"),q=(0,l.M)(t,"reportWebVitals"),U=(0,l.M)(t,"unstable_getStaticProps"),D=(0,l.M)(t,"unstable_getStaticPaths"),_=(0,l.M)(t,"unstable_getStaticParams"),T=(0,l.M)(t,"unstable_getServerProps"),E=(0,l.M)(t,"unstable_getServerSideProps"),R=new a.PagesRouteModule({definition:{kind:n.A.PAGES,page:"/admin/exchange-rate",pathname:"/admin/exchange-rate",bundlePath:"",filename:""},components:{App:u(),Document:d()},userland:t})},96330:e=>{e.exports=require("@prisma/client")}};var r=require("../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[8548,1803],()=>s(90659));module.exports=t})();