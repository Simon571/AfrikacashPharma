(()=>{var e={};e.id=2715,e.ids=[2715],e.modules={87:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\Public\\\\Documents\\\\Console Afrikapharma\\\\AfrikaPharma\\\\src\\\\app\\\\(app)\\\\ventes\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Public\\Documents\\Console Afrikapharma\\AfrikaPharma\\src\\app\\(app)\\ventes\\page.tsx","default")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14729:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>o});var r=t(65239),a=t(48088),n=t(88170),i=t.n(n),l=t(30893),c={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);t.d(s,c);let o={children:["",{children:["(app)",{children:["ventes",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,87)),"C:\\Users\\Public\\Documents\\Console Afrikapharma\\AfrikaPharma\\src\\app\\(app)\\ventes\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,70718)),"C:\\Users\\Public\\Documents\\Console Afrikapharma\\AfrikaPharma\\src\\app\\(app)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,94431)),"C:\\Users\\Public\\Documents\\Console Afrikapharma\\AfrikaPharma\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["C:\\Users\\Public\\Documents\\Console Afrikapharma\\AfrikaPharma\\src\\app\\(app)\\ventes\\page.tsx"],m={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/(app)/ventes/page",pathname:"/ventes",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},15121:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>P});var r=t(60687),a=t(43210),n=t.n(a),i=t(89667),l=t(29523),c=t(6211),o=t(44493),d=t(52581),m=t(62459),u=t(41862),x=t(1303),p=t(28561),h=t(88233),f=t(2271),j=t(71444),v=t(68133),b=t(32457),g=t(30859),y=t(4780),N=t(63503),w=t(40140),C=t(80013),A=t(57008),k=t(38778);function P(){let[e,s]=(0,a.useState)(""),[t,P]=(0,a.useState)([]),[q,R]=(0,a.useState)([]),[S,$]=(0,a.useState)(""),[E,z]=(0,a.useState)("name"),[_,I]=(0,a.useState)(!1),[D,F]=(0,a.useState)(!1),[L,T]=(0,a.useState)(!1),M=n().useRef(null),[O,G]=(0,a.useState)(!1),[U,H]=(0,a.useState)(!1),Z=(0,v.d)(e,300),B=(0,a.useCallback)(async(e="")=>{F(!0);try{let s=await (0,b.Pz)({search:e.trim()});Array.isArray(s)?P(s):(console.error("Invalid data format received:",s),P([]))}catch(e){console.error("Error loading medications:",e),d.oR.error("Erreur lors du chargement des m\xe9dicaments"),P([])}finally{F(!1)}},[]),J=(0,a.useCallback)(e=>{if(e.quantity<=0)return void d.oR.error("Ce m\xe9dicament est en rupture de stock");R(s=>{let t=s.find(s=>s.medication.id===e.id);if(!t)return d.oR.success(`${e.name} ajout\xe9 au panier`),[...s,{medication:e,quantity:1}];{if(t.quantity>=e.quantity)return d.oR.error("Stock insuffisant"),s;let r=s.map(s=>s.medication.id===e.id?{...s,quantity:s.quantity+1}:s);return d.oR.success(`${e.name} ajout\xe9 au panier`),r}})},[]),V=(0,a.useCallback)((e,s)=>{R(t=>s<=0?t.filter(s=>s.medication.id!==e):t.map(t=>t.medication.id===e?s>t.medication.quantity?(d.oR.error("Stock insuffisant"),t):{...t,quantity:s}:t))},[]),W=(0,a.useCallback)(e=>{R(s=>s.filter(s=>s.medication.id!==e)),d.oR.success("Article retir\xe9 du panier")},[]),X=(0,a.useCallback)(()=>{R([]),d.oR.success("Panier vid\xe9")},[]),K=q.reduce((e,s)=>e+s.medication.price*s.quantity,0),Q=(0,g.useReactToPrint)({contentRef:M,documentTitle:`Facture-${new Date().toISOString().split("T")[0]}`,onAfterPrint:()=>{H(!1),d.oR.success("Facture imprim\xe9e/enregistr\xe9e avec succ\xe8s!")}}),Y=(0,a.useCallback)(async()=>{if(0===q.length)return void d.oR.error("Le panier est vide");try{let e={clientName:S||"Client",items:q.map(e=>({medicationId:e.medication.id,quantity:e.quantity,unitPrice:e.medication.price})),totalAmount:K};if(!(await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Erreur lors de la vente");d.oR.success("Vente effectu\xe9e avec succ\xe8s !"),R([]),$(""),await B(Z),setTimeout(()=>{Q()},500)}catch(e){console.error("Error completing sale:",e),d.oR.error("Erreur lors de la vente")}},[q,S,K,B,Z,Q]),ee=(0,a.useCallback)(()=>{G(!0)},[]),es=(0,a.useCallback)(()=>{G(!1)},[]),et=(0,a.useCallback)(async e=>{try{let s=await fetch(`/api/medications/barcode/${e}`);if(s.ok){let e=await s.json();e?(J(e),es(),d.oR.success(`M\xe9dicament trouv\xe9: ${e.name}`)):d.oR.error("Aucun m\xe9dicament trouv\xe9 avec ce code-barres")}else d.oR.error("Erreur lors de la recherche du m\xe9dicament")}catch(e){console.error("Error fetching medication by barcode:",e),d.oR.error("Erreur lors de la recherche du m\xe9dicament par code-barres.")}},[J,es]),er=(0,a.useCallback)(()=>{},[]),ea=t.filter(s=>{if(!_&&s.quantity<=0)return!1;if(e&&e.length>0){let t=e.toLowerCase();return s.name.toLowerCase().includes(t)||s.barcode&&s.barcode.toLowerCase().includes(t)}return!0}).filter((e,s,t)=>t.findIndex(s=>s.name===e.name&&s.price===e.price&&s.quantity===e.quantity)===s).sort((e,s)=>{switch(E){case"name":return e.name.localeCompare(s.name);case"price":return e.price-s.price;case"stock":return s.quantity-e.quantity;default:return 0}});return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(k.default,{userRole:"seller"}),(0,r.jsxs)("div",{className:"container mx-auto p-2 sm:p-4 lg:p-6 lg:pl-6",children:[(0,r.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,r.jsx)("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900",children:"Interface de Vente"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1 sm:mt-2 text-sm sm:text-base",children:"Recherchez et vendez des m\xe9dicaments"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3 lg:gap-6",children:[(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-3 lg:space-y-4",children:[(0,r.jsxs)(o.Zp,{children:[(0,r.jsx)(o.aR,{className:"pb-3",children:(0,r.jsxs)(o.ZB,{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[(0,r.jsxs)("span",{className:"text-lg",children:["Recherche de M\xe9dicaments",ea.length>0&&(0,r.jsxs)("span",{className:"text-sm font-normal ml-2 bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:[ea.length," disponible",ea.length>1?"s":""]})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,r.jsxs)(l.$,{onClick:ee,size:"sm",variant:"outline",className:"h-8 sm:h-9 cursor-pointer",children:[(0,r.jsx)(m.A,{className:"h-4 w-4 mr-1"}),"Scanner"]}),(0,r.jsxs)(l.$,{onClick:()=>I(!_),size:"sm",variant:_?"default":"outline",className:"h-8 sm:h-9 cursor-pointer",children:[_?"Masquer":"Afficher"," ruptures"]})]})]})}),(0,r.jsx)(o.Wu,{className:"space-y-3",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(i.p,{type:"text",placeholder:"Rechercher par nom ou code-barres...",value:e,onChange:e=>s(e.target.value),className:"w-full text-sm sm:text-base"}),(D||L)&&(0,r.jsx)(u.A,{className:"absolute right-3 top-2.5 h-4 w-4 animate-spin text-gray-400"})]}),(0,r.jsxs)("select",{value:E,onChange:e=>z(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm sm:text-base min-w-[120px]",children:[(0,r.jsx)("option",{value:"name",children:"Nom"}),(0,r.jsx)("option",{value:"price",children:"Prix"}),(0,r.jsx)("option",{value:"stock",children:"Stock"})]})]})})]}),(0,r.jsx)(o.Zp,{children:(0,r.jsxs)(o.Wu,{className:"p-0 relative",children:[(0,r.jsx)("div",{className:"text-xs text-white text-center py-1 bg-green-600 border-b",children:"âœ… MODIFICATIONS APPLIQU\xc9ES - Interface tableau optimis\xe9e"}),ea.length>5&&(0,r.jsx)("div",{className:"text-xs text-gray-500 text-center py-1 bg-blue-50 border-b",children:"\uD83D\uDCDC Faites d\xe9filer pour voir tous les m\xe9dicaments"}),(0,r.jsx)("div",{className:"overflow-x-auto max-h-[50vh] sm:max-h-[55vh] lg:max-h-[60vh] overflow-y-auto",children:(0,r.jsxs)(c.XI,{children:[(0,r.jsx)(c.A0,{className:"sticky top-0 bg-white z-10 shadow-sm",children:(0,r.jsxs)(c.Hj,{children:[(0,r.jsx)(c.nd,{className:"text-sm",children:"Nom"}),(0,r.jsx)(c.nd,{className:"text-sm",children:"Prix"}),(0,r.jsx)(c.nd,{className:"text-sm",children:"Stock"}),(0,r.jsx)(c.nd,{className:"text-sm",children:"Action"})]})}),(0,r.jsx)(c.BF,{children:0===ea.length?(0,r.jsx)(c.Hj,{children:(0,r.jsx)(c.nA,{colSpan:4,className:"text-center py-8 text-gray-500",children:D?"Chargement...":"Aucun m\xe9dicament trouv\xe9"})}):ea.map(e=>(0,r.jsxs)(c.Hj,{className:"hover:bg-gray-50",children:[(0,r.jsx)(c.nA,{className:"font-medium text-sm",children:e.name}),(0,r.jsx)(c.nA,{className:"text-green-600 font-semibold text-sm",children:(0,y.vv)(e.price)}),(0,r.jsx)(c.nA,{className:"text-sm",children:(0,r.jsx)("span",{className:e.quantity<=0?"text-red-600":"text-green-600",children:e.quantity})}),(0,r.jsx)(c.nA,{children:(0,r.jsxs)(l.$,{onClick:()=>J(e),disabled:e.quantity<=0,size:"sm",className:"text-xs px-2 py-1 cursor-pointer disabled:cursor-not-allowed",children:[(0,r.jsx)(x.A,{className:"h-3 w-3 mr-1"}),"+"]})})]},e.id))})]})})]})})]}),(0,r.jsx)("div",{className:"space-y-3 lg:space-y-4",children:(0,r.jsxs)(o.Zp,{children:[(0,r.jsx)(o.aR,{className:"pb-3",children:(0,r.jsxs)(o.ZB,{className:"flex items-center justify-between text-lg",children:[(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)(p.A,{className:"h-5 w-5 mr-2"}),"Panier (",q.length,")"]}),q.length>0&&(0,r.jsxs)(l.$,{onClick:X,variant:"outline",size:"sm",className:"h-8 text-xs cursor-pointer",children:[(0,r.jsx)(h.A,{className:"h-3 w-3 mr-1"}),"Vider"]})]})}),(0,r.jsx)(o.Wu,{className:"space-y-3",children:0===q.length?(0,r.jsx)("p",{className:"text-gray-500 text-center py-4 text-sm",children:"Le panier est vide"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"space-y-2 max-h-[35vh] sm:max-h-[40vh] lg:max-h-[45vh] overflow-y-auto border rounded-md p-2 bg-gray-50",children:q.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg p-2 bg-gray-50",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h4",{className:"font-medium text-xs sm:text-sm leading-tight truncate",children:e.medication.name}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,y.vv)(e.medication.price)," x ",e.quantity]})]}),(0,r.jsx)(l.$,{onClick:()=>W(e.medication.id),variant:"ghost",size:"sm",className:"h-6 w-6 p-0 ml-1 cursor-pointer",children:(0,r.jsx)(h.A,{className:"h-3 w-3"})})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(l.$,{onClick:()=>V(e.medication.id,e.quantity-1),variant:"outline",size:"sm",className:"h-6 w-6 p-0 cursor-pointer",children:(0,r.jsx)(f.A,{className:"h-3 w-3"})}),(0,r.jsx)("span",{className:"font-medium text-sm min-w-[2rem] text-center",children:e.quantity}),(0,r.jsx)(l.$,{onClick:()=>V(e.medication.id,e.quantity+1),variant:"outline",size:"sm",className:"h-6 w-6 p-0 cursor-pointer disabled:cursor-not-allowed",disabled:e.quantity>=e.medication.quantity,children:(0,r.jsx)(x.A,{className:"h-3 w-3"})})]}),(0,r.jsx)("span",{className:"font-semibold text-green-600 text-sm",children:(0,y.vv)(e.medication.price*e.quantity)})]})]},e.medication.id))}),(0,r.jsxs)("div",{className:"border-t pt-3 space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,r.jsx)("span",{children:"Total:"}),(0,r.jsx)("span",{className:"text-green-600",children:(0,y.vv)(K)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(C.J,{htmlFor:"clientName",className:"text-sm",children:"Nom du client (optionnel)"}),(0,r.jsx)(i.p,{id:"clientName",type:"text",placeholder:"Nom du client...",value:S,onChange:e=>$(e.target.value),className:"text-sm"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(l.$,{onClick:Y,className:"w-full text-sm cursor-pointer",children:[(0,r.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Finaliser la vente"]}),(0,r.jsxs)(l.$,{onClick:()=>{if(0===q.length)return void d.oR.error("Le panier est vide. Impossible de g\xe9n\xe9rer une facture.");H(!0)},variant:"outline",className:"w-full text-sm cursor-pointer",children:[(0,r.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Aper\xe7u & Impression"]})]})]})]})})]})})]}),(0,r.jsx)(N.lG,{open:U,onOpenChange:H,children:(0,r.jsxs)(N.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)(N.c7,{children:(0,r.jsx)(N.L3,{children:"Aper\xe7u de la facture"})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"border rounded-lg p-4 bg-white",children:(0,r.jsx)(A.A,{ref:M,cart:q,totalAmount:K,clientName:S})}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t",children:[(0,r.jsx)(l.$,{variant:"outline",onClick:()=>H(!1),className:"cursor-pointer",children:"Annuler"}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsxs)(l.$,{onClick:()=>{let e=window.open("","_blank");if(e&&M.current){let s=M.current.innerHTML||"";e.document.write(`
                        <html>
                          <head>
                            <title>Facture PAJO PHARMA</title>
                            <style>
                              body { font-family: Arial, sans-serif; margin: 20px; }
                              .print-header { text-align: center; margin-bottom: 20px; }
                              table { width: 100%; border-collapse: collapse; }
                              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                              th { background-color: #f2f2f2; }
                              .total { font-weight: bold; font-size: 18px; }
                              @media print { 
                                body { margin: 0; }
                                .no-print { display: none; }
                              }
                            </style>
                          </head>
                          <body>
                            ${s}
                          </body>
                        </html>
                      `),e.document.close(),e.print(),e.close(),H(!1),d.oR.success("Facture imprim\xe9e avec succ\xe8s!")}},variant:"outline",className:"cursor-pointer",children:[(0,r.jsx)(j.A,{className:"mr-2 h-4 w-4"}),"Imprimer directement"]}),(0,r.jsxs)(l.$,{onClick:Q,className:"bg-blue-600 hover:bg-blue-700 cursor-pointer",children:[(0,r.jsx)(j.A,{className:"mr-2 h-4 w-4"}),"Enregistrer PDF"]})]})]})]})]})}),(0,r.jsx)(N.lG,{open:O,onOpenChange:G,children:(0,r.jsxs)(N.Cf,{className:"sm:max-w-md",children:[(0,r.jsx)(N.c7,{children:(0,r.jsx)(N.L3,{children:"Scanner un code-barres"})}),(0,r.jsx)(w.A,{onScanSuccess:et,onScanError:er})]})}),(0,r.jsx)("div",{style:{display:"none"},children:(0,r.jsx)(A.A,{ref:M,cart:q,totalAmount:K,clientName:S})})]})]})}},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},56643:(e,s,t)=>{Promise.resolve().then(t.bind(t,15121))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79551:e=>{"use strict";e.exports=require("url")},80619:(e,s,t)=>{Promise.resolve().then(t.bind(t,87))}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[4243,6915,1422,1658,2152,9853,1396,1799],()=>t(14729));module.exports=r})();