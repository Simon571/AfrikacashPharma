"use strict";(()=>{var e={};e.id=7726,e.ids=[7726],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},37419:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>x,serverHooks:()=>h,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>g});var n={};t.r(n),t.d(n,{GET:()=>m,POST:()=>d});var s=t(96559),a=t(48088),o=t(37719),i=t(32190),u=t(45178),p=t(79464);let c=new u.b;async function l(e){return!0}async function d(e){try{if(!await l(e))return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json();if(!r.name||!r.subdomain||!r.ownerEmail||!r.planType)return i.NextResponse.json({error:"Missing required fields: name, subdomain, ownerEmail, planType"},{status:400});console.log("Creating instance with:",r);let t=await p.z.subscription.create({data:{planType:r.planType,planName:`${r.planType} Plan`,status:"ACTIVE",amount:0,currency:"EUR"}}),n=await p.z.instance.create({data:{name:r.name,subdomain:r.subdomain,ownerName:r.ownerName||r.ownerEmail.split("@")[0],ownerEmail:r.ownerEmail,ownerPhone:r.ownerPhone,subscriptionId:t.id,status:"active",apiKey:`key_${Math.random().toString(36).substr(2,9)}`},include:{subscription:!0,settings:!0}});return console.log("Instance created:",n),i.NextResponse.json(n,{status:201})}catch(r){console.error("Error creating instance:",r);let e=r instanceof Error?r.message:"Internal server error";return console.error("Full error:",r),i.NextResponse.json({error:e},{status:500})}}async function m(e){try{if(!await l(e))return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=new URL(e.url),t=r.searchParams.get("status"),n=r.searchParams.get("planType"),s=parseInt(r.searchParams.get("limit")||"50"),a=parseInt(r.searchParams.get("offset")||"0"),o=await c.listInstances({status:t||void 0,planType:n||void 0,limit:s,offset:a});return i.NextResponse.json(o)}catch(e){return console.error("Error listing instances:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let x=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/instances/route",pathname:"/api/admin/instances",filename:"route",bundlePath:"app/api/admin/instances/route"},resolvedPagePath:"C:\\Users\\Public\\Documents\\Console Afrikapharma\\app\\api\\admin\\instances\\route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:w,workUnitAsyncStorage:g,serverHooks:h}=x;function y(){return(0,o.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:g})}},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},96330:e=>{e.exports=require("@prisma/client")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[4243,580,4678],()=>t(37419));module.exports=n})();