{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Public/Documents/AfrikaPharma/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\ndeclare global {\n  // allow global `var` declarations\n  \n  var prisma: PrismaClient | undefined;\n}\n\nexport const prisma = global.prisma || new PrismaClient();\n\nif (process.env.NODE_ENV !== 'production') global.prisma = prisma;\n"],"names":[],"mappings":";;;AAAA;;AAQO,MAAM,SAAS,OAAO,MAAM,IAAI,IAAI,6HAAA,CAAA,eAAY;AAEvD,wCAA2C,OAAO,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Public/Documents/AfrikaPharma/src/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from 'next-auth';\nimport CredentialsProvider from 'next-auth/providers/credentials';\nimport { PrismaAdapter } from '@next-auth/prisma-adapter';\nimport { prisma } from '@/lib/prisma';\nimport bcrypt from 'bcryptjs';\n\nexport const authOptions: NextAuthOptions = {\n  // Commenté: L'adapter Prisma peut interférer avec CredentialsProvider\n  // adapter: PrismaAdapter(prisma),\n  providers: [\n    CredentialsProvider({\n      name: 'Credentials',\n      credentials: {\n        username: { label: 'Username', type: 'text' },\n        password: { label: 'Password', type: 'password' },\n      },\n      async authorize(credentials) {\n        console.log('[auth] Tentative de connexion', credentials?.username ?? '(aucun)');\n\n        if (!credentials?.username || !credentials.password) {\n          console.warn('[auth] Identifiants incomplets');\n          return null;\n        }\n\n        try {\n          const user = await prisma.user.findUnique({\n            where: { username: credentials.username },\n          });\n\n          if (!user) {\n            console.warn('[auth] Utilisateur introuvable', credentials.username);\n            return null;\n          }\n\n          const passwordOk = await bcrypt.compare(credentials.password, user.passwordHash);\n          console.log('[auth] Vérification mot de passe', passwordOk ? 'OK' : 'ECHEC');\n\n          if (!passwordOk) {\n            return null;\n          }\n\n          return { id: user.id, name: user.username, role: user.role };\n        } catch (error) {\n          console.error('[auth] Erreur:', error);\n          // Fallback: Utilisateurs par défaut si BD indisponible\n          const DEFAULT_USERS = [\n            { id: 'admin-1', username: 'admin', password: 'Admin123!', role: 'admin' },\n            { id: 'seller-1', username: 'vendeur', password: 'vendeur123', role: 'seller' },\n            { id: 'superadmin-1', username: 'superadmin', password: 'SuperAdmin123!', role: 'admin' }\n          ];\n          \n          const defaultUser = DEFAULT_USERS.find(u => u.username === credentials.username);\n          if (defaultUser && defaultUser.password === credentials.password) {\n            console.log('[auth] Authentification avec utilisateur par défaut');\n            return { id: defaultUser.id, name: defaultUser.username, role: defaultUser.role };\n          }\n          return null;\n        }\n      },\n    }),\n  ],\n  session: {\n    strategy: 'jwt',\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        token.id = user.id;\n        token.role = user.role;\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      if (session.user) {\n        session.user.id = token.id as string;\n        session.user.role = token.role as string;\n      }\n      return session;\n    },\n  },\n  pages: {\n    signIn: '/',\n    error: '/auth/error',\n    signOut: '/',\n  },\n};"],"names":[],"mappings":";;;AACA;AAEA;AACA;;;;AAEO,MAAM,cAA+B;IAC1C,sEAAsE;IACtE,kCAAkC;IAClC,WAAW;QACT,CAAA,GAAA,0JAAA,CAAA,UAAmB,AAAD,EAAE;YAClB,MAAM;YACN,aAAa;gBACX,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAO;gBAC5C,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,QAAQ,GAAG,CAAC,iCAAiC,aAAa,YAAY;gBAEtE,IAAI,CAAC,aAAa,YAAY,CAAC,YAAY,QAAQ,EAAE;oBACnD,QAAQ,IAAI,CAAC;oBACb,OAAO;gBACT;gBAEA,IAAI;oBACF,MAAM,OAAO,MAAM,sHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,UAAU,CAAC;wBACxC,OAAO;4BAAE,UAAU,YAAY,QAAQ;wBAAC;oBAC1C;oBAEA,IAAI,CAAC,MAAM;wBACT,QAAQ,IAAI,CAAC,kCAAkC,YAAY,QAAQ;wBACnE,OAAO;oBACT;oBAEA,MAAM,aAAa,MAAM,mIAAA,CAAA,UAAM,CAAC,OAAO,CAAC,YAAY,QAAQ,EAAE,KAAK,YAAY;oBAC/E,QAAQ,GAAG,CAAC,oCAAoC,aAAa,OAAO;oBAEpE,IAAI,CAAC,YAAY;wBACf,OAAO;oBACT;oBAEA,OAAO;wBAAE,IAAI,KAAK,EAAE;wBAAE,MAAM,KAAK,QAAQ;wBAAE,MAAM,KAAK,IAAI;oBAAC;gBAC7D,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,kBAAkB;oBAChC,uDAAuD;oBACvD,MAAM,gBAAgB;wBACpB;4BAAE,IAAI;4BAAW,UAAU;4BAAS,UAAU;4BAAa,MAAM;wBAAQ;wBACzE;4BAAE,IAAI;4BAAY,UAAU;4BAAW,UAAU;4BAAc,MAAM;wBAAS;wBAC9E;4BAAE,IAAI;4BAAgB,UAAU;4BAAc,UAAU;4BAAkB,MAAM;wBAAQ;qBACzF;oBAED,MAAM,cAAc,cAAc,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,YAAY,QAAQ;oBAC/E,IAAI,eAAe,YAAY,QAAQ,KAAK,YAAY,QAAQ,EAAE;wBAChE,QAAQ,GAAG,CAAC;wBACZ,OAAO;4BAAE,IAAI,YAAY,EAAE;4BAAE,MAAM,YAAY,QAAQ;4BAAE,MAAM,YAAY,IAAI;wBAAC;oBAClF;oBACA,OAAO;gBACT;YACF;QACF;KACD;IACD,SAAS;QACP,UAAU;IACZ;IACA,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,KAAK,IAAI;YACxB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YAChC;YACA,OAAO;QACT;IACF;IACA,OAAO;QACL,QAAQ;QACR,OAAO;QACP,SAAS;IACX;AACF","debugId":null}},
    {"offset": {"line": 280, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Public/Documents/AfrikaPharma/src/app/api/medications/reorder-suggestions/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\nimport { getServerSession } from 'next-auth';\nimport { authOptions } from '@/lib/auth';\n\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n\n    if (!session || session.user?.role !== 'admin') {\n      return NextResponse.json({ message: 'Unauthorized' }, { status: 403 });\n    }\n\n    const medications = await prisma.medication.findMany({\n      include: {\n        saleItems: {\n          where: {\n            sale: {\n              date: {\n                gte: new Date(new Date().setDate(new Date().getDate() - 30)), // Last 30 days\n              },\n            },\n          },\n          select: {\n            quantity: true,\n          },\n        },\n      },\n    });\n\n    const reorderSuggestions = medications\n      .map((medication) => {\n        const totalSoldLast30Days = medication.saleItems.reduce(\n          (sum, item) => sum + item.quantity,\n          0\n        );\n        const dailyAverageSold = totalSoldLast30Days / 30;\n\n        // Suggest reorder if current quantity is less than 7 days of average sales\n        const reorderThreshold = dailyAverageSold * 7;\n\n        if (medication.quantity < reorderThreshold) {\n          const suggestedOrderQuantity = Math.ceil(reorderThreshold * 2 - medication.quantity); // Order enough for 2 weeks\n          return {\n            id: medication.id,\n            name: medication.name,\n            currentQuantity: medication.quantity,\n            dailyAverageSold: parseFloat(dailyAverageSold.toFixed(2)),\n            suggestedOrderQuantity: suggestedOrderQuantity > 0 ? suggestedOrderQuantity : 1,\n            reason: `Stock faible (moins de 7 jours de ventes moyennes). Ventes moyennes journalières: ${dailyAverageSold.toFixed(2)}`,\n          };\n        }\n        return null;\n      })\n      .filter(Boolean);\n\n    return NextResponse.json(reorderSuggestions);\n  } catch (error) {\n    console.error('Error fetching reorder suggestions:', error);\n    return NextResponse.json(\n      { message: 'Error fetching reorder suggestions' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,UAAU,MAAM,CAAA,GAAA,uIAAA,CAAA,mBAAgB,AAAD,EAAE,oHAAA,CAAA,cAAW;QAElD,IAAI,CAAC,WAAW,QAAQ,IAAI,EAAE,SAAS,SAAS;YAC9C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,cAAc,MAAM,sHAAA,CAAA,SAAM,CAAC,UAAU,CAAC,QAAQ,CAAC;YACnD,SAAS;gBACP,WAAW;oBACT,OAAO;wBACL,MAAM;4BACJ,MAAM;gCACJ,KAAK,IAAI,KAAK,IAAI,OAAO,OAAO,CAAC,IAAI,OAAO,OAAO,KAAK;4BAC1D;wBACF;oBACF;oBACA,QAAQ;wBACN,UAAU;oBACZ;gBACF;YACF;QACF;QAEA,MAAM,qBAAqB,YACxB,GAAG,CAAC,CAAC;YACJ,MAAM,sBAAsB,WAAW,SAAS,CAAC,MAAM,CACrD,CAAC,KAAK,OAAS,MAAM,KAAK,QAAQ,EAClC;YAEF,MAAM,mBAAmB,sBAAsB;YAE/C,2EAA2E;YAC3E,MAAM,mBAAmB,mBAAmB;YAE5C,IAAI,WAAW,QAAQ,GAAG,kBAAkB;gBAC1C,MAAM,yBAAyB,KAAK,IAAI,CAAC,mBAAmB,IAAI,WAAW,QAAQ,GAAG,2BAA2B;gBACjH,OAAO;oBACL,IAAI,WAAW,EAAE;oBACjB,MAAM,WAAW,IAAI;oBACrB,iBAAiB,WAAW,QAAQ;oBACpC,kBAAkB,WAAW,iBAAiB,OAAO,CAAC;oBACtD,wBAAwB,yBAAyB,IAAI,yBAAyB;oBAC9E,QAAQ,CAAC,kFAAkF,EAAE,iBAAiB,OAAO,CAAC,IAAI;gBAC5H;YACF;YACA,OAAO;QACT,GACC,MAAM,CAAC;QAEV,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;QACrD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,SAAS;QAAqC,GAChD;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}