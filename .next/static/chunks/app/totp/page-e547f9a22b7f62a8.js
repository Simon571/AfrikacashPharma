(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4782],{1350:(e,s,t)=>{Promise.resolve().then(t.bind(t,9936))},9936:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>u});var a=t(5155),l=t(2115),r=t(6862),i=t(4109),n=t(7939),o=t(232),c=t(1154),d=t(3453),m=t(5339),x=t(4357);let p=[{title:"G\xe9n\xe9rer",description:"Cr\xe9ez un secret unique et obtenez le QR Code \xe0 scanner.",icon:i.A},{title:"Scanner",description:"Ajoutez le compte dans votre application d'authentification.",icon:n.A},{title:"Valider",description:"Saisissez le code \xe0 usage unique pour activer la 2FA.",icon:o.A}];function u(){let[e,s]=(0,l.useState)(!1),[t,u]=(0,l.useState)(null),[h,b]=(0,l.useState)(null),[g,f]=(0,l.useState)(""),[j,w]=(0,l.useState)({type:"info",message:"G\xe9n\xe9rez un QR Code pour d\xe9marrer."}),[N,v]=(0,l.useState)(null),y=(0,l.useMemo)(()=>N?3:h?2:1,[h,N]),C=(0,l.useCallback)(async()=>{s(!0),w(null),v(null);try{let e=await fetch("/api/auth/totp/generate");if(!e.ok)throw Error(await e.text());let s=await e.json();u(s.otpauth_url);let t=await r.toDataURL(s.otpauth_url);b(t),w({type:"success",message:"QR Code g\xe9n\xe9r\xe9. Scannez-le avec votre application."})}catch(s){let e=s instanceof Error?s.message:String(s);w({type:"error",message:"\xc9chec de g\xe9n\xe9ration : ".concat(e)}),u(null),b(null)}finally{s(!1)}},[]),k=(0,l.useCallback)(async()=>{if(g){s(!0),w(null);try{let e=await fetch("/api/auth/totp/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:g})}),s=await e.json();if(!e.ok)throw Error(s.error||JSON.stringify(s));w({type:"success",message:"TOTP v\xe9rifi\xe9 et activ\xe9."}),v(new Date)}catch(s){let e=s instanceof Error?s.message:String(s);w({type:"error",message:"V\xe9rification impossible : ".concat(e)}),v(null)}finally{s(!1)}}},[g]),S=(0,l.useCallback)(async()=>{if(t)try{var e;if("undefined"==typeof navigator||!(null==(e=navigator.clipboard)?void 0:e.writeText))throw Error("Clipboard API indisponible dans ce navigateur");await navigator.clipboard.writeText(t),w({type:"success",message:"Lien copi\xe9 dans le presse-papiers."}),setTimeout(()=>w(null),3500)}catch(s){let e=s instanceof Error?s.message:String(s);w({type:"error",message:"Impossible de copier : ".concat(e)}),setTimeout(()=>w(null),4e3)}},[t]);return(0,a.jsx)("main",{className:"mx-auto max-w-4xl px-4 pb-16 pt-12",children:(0,a.jsxs)("div",{className:"grid gap-8 lg:grid-cols-[1.4fr,1fr]",children:[(0,a.jsxs)("section",{className:"rounded-3xl border border-slate-200 bg-white/90 p-8 shadow-lg backdrop-blur",children:[(0,a.jsxs)("header",{className:"flex flex-col gap-3",children:[(0,a.jsx)("span",{className:"text-xs font-semibold uppercase tracking-[0.35em] text-emerald-500",children:"S\xe9curit\xe9"}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"Activer la double authentification"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"Renforcez la s\xe9curit\xe9 des comptes en ajoutant une couche de v\xe9rification bas\xe9e sur le temps. Suivez les \xe9tapes et validez le code g\xe9n\xe9r\xe9 pour finaliser."})]}),(0,a.jsx)("div",{className:"mt-8 grid gap-4 sm:grid-cols-3",children:p.map((e,s)=>{let t=e.icon,l=s+1===y;return(0,a.jsxs)("div",{className:"rounded-2xl border p-4 text-sm transition ".concat(s+1<y?"border-emerald-200 bg-emerald-50/60 text-emerald-700":l?"border-slate-900/10 bg-slate-900 text-white":"border-slate-200 bg-slate-50 text-slate-500"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"flex h-10 w-10 items-center justify-center rounded-xl ".concat(l?"bg-white/10":"bg-white"),children:(0,a.jsx)(t,{className:"h-5 w-5 ".concat(l?"text-white":"text-slate-600")})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-xs font-semibold uppercase tracking-wider",children:["\xc9tape ",s+1]}),(0,a.jsx)("p",{className:"font-semibold",children:e.title})]})]}),(0,a.jsx)("p",{className:"mt-3 text-xs leading-relaxed",children:e.description})]},e.title)})}),(0,a.jsxs)("div",{className:"mt-10 flex flex-wrap items-center gap-3",children:[(0,a.jsxs)("button",{onClick:()=>void C(),disabled:e,className:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-5 py-2 text-sm font-semibold text-white shadow-lg shadow-emerald-500/30 transition hover:bg-emerald-500 disabled:cursor-not-allowed disabled:opacity-70",children:[e?(0,a.jsx)(c.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(i.A,{className:"h-4 w-4"}),"G\xe9n\xe9rer un QR Code"]}),(0,a.jsxs)("button",{onClick:()=>void k(),disabled:e||!g,className:"inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-5 py-2 text-sm font-semibold text-slate-700 shadow-sm transition hover:border-emerald-300 hover:text-emerald-600 disabled:cursor-not-allowed disabled:opacity-60",children:[(0,a.jsx)(o.A,{className:"h-4 w-4"}),"V\xe9rifier le code"]}),j&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-2 rounded-full px-4 py-2 text-xs font-semibold ".concat("success"===j.type?"bg-emerald-50 text-emerald-700":"error"===j.type?"bg-rose-50 text-rose-600":"bg-slate-100 text-slate-600"),children:["success"===j.type?(0,a.jsx)(d.A,{className:"h-4 w-4"}):"error"===j.type?(0,a.jsx)(m.A,{className:"h-4 w-4"}):(0,a.jsx)(o.A,{className:"h-4 w-4"}),j.message]})]}),(0,a.jsxs)("div",{className:"mt-10 flex flex-col gap-6",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-1 text-sm text-slate-600",children:[(0,a.jsx)("span",{children:"Code \xe0 6 chiffres"}),(0,a.jsx)("input",{value:g,onChange:e=>f(e.target.value.replace(/[^\d]/g,"")),inputMode:"numeric",maxLength:6,placeholder:"000000",className:"w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-lg tracking-[0.4em] text-slate-900 shadow-inner focus:border-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-100"})]}),N&&(0,a.jsxs)("p",{className:"text-xs text-emerald-600",children:["Derni\xe8re v\xe9rification r\xe9ussie : ",N.toLocaleTimeString()]})]})]}),(0,a.jsxs)("aside",{className:"flex flex-col gap-4 rounded-3xl border border-emerald-200 bg-gradient-to-br from-emerald-50 via-white to-white p-6 shadow-inner",children:[(0,a.jsxs)("h2",{className:"flex items-center gap-2 text-sm font-semibold uppercase tracking-widest text-emerald-600",children:[(0,a.jsx)(o.A,{className:"h-4 w-4"})," M\xe9mo de s\xe9curit\xe9"]}),(0,a.jsxs)("ul",{className:"space-y-3 text-sm text-emerald-900",children:[(0,a.jsx)("li",{children:"• Limitez l'acc\xe8s TOTP aux comptes privil\xe9gi\xe9s seulement."}),(0,a.jsx)("li",{children:"• Conservez un canal de secours (codes de r\xe9cup\xe9ration) hors ligne."}),(0,a.jsx)("li",{children:"• V\xe9rifiez la date et l'heure du terminal : un d\xe9calage casse la v\xe9rification."})]}),(0,a.jsxs)("div",{className:"rounded-2xl border border-emerald-200 bg-white p-4 shadow-sm",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-slate-800",children:"QR Code"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:"Visible uniquement apr\xe8s g\xe9n\xe9ration."}),h?(0,a.jsxs)("div",{className:"mt-4 flex flex-col items-center gap-3",children:[(0,a.jsx)("img",{src:h,alt:"QR Code TOTP",className:"h-48 w-48 rounded-2xl border border-slate-200 bg-slate-50 p-3 shadow-md"}),(0,a.jsxs)("button",{onClick:()=>void S(),className:"inline-flex items-center gap-2 rounded-full border border-emerald-300 bg-emerald-500/10 px-4 py-2 text-xs font-semibold text-emerald-700 transition hover:bg-emerald-500/20",children:[(0,a.jsx)(x.A,{className:"h-4 w-4"})," Copier l'URL otpauth"]})]}):(0,a.jsxs)("div",{className:"mt-4 flex flex-col items-center gap-3 rounded-xl border border-dashed border-emerald-300 bg-emerald-100/40 px-6 py-10 text-center text-xs text-emerald-700",children:[(0,a.jsx)(n.A,{className:"h-8 w-8"}),"Le QR appara\xeetra ici apr\xe8s g\xe9n\xe9ration."]})]}),t&&(0,a.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-900 p-4 text-xs text-slate-100",children:[(0,a.jsx)("p",{className:"font-semibold text-emerald-300",children:"URL otpauth"}),(0,a.jsx)("p",{className:"mt-2 break-all font-mono text-[11px] leading-5",children:t})]})]})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[500,8441,1684,7358],()=>s(1350)),_N_E=e.O()}]);