(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3958],{4887:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>d});var t=a(5155),l=a(2115);let n=async()=>{let e=await fetch("/api/admin/trials",{credentials:"include"});return(await e.json()).trials||[]},r=async e=>(await fetch("/api/admin/trials/".concat(e,"/extend"),{method:"POST",credentials:"include"})).ok,i=async(e,s)=>(await fetch("/api/admin/trials/".concat(e,"/block"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:s}),credentials:"include"})).ok;function d(){let[e,s]=(0,l.useState)([]),[a,d]=(0,l.useState)(!0),[c,o]=(0,l.useState)(""),[x,u]=(0,l.useState)(""),[h,p]=(0,l.useState)(""),[m,b]=(0,l.useState)("");(0,l.useEffect)(()=>{n().then(e=>{s(e),d(!1)})},[]);let j=async e=>{d(!0),o(await r(e)?"Essai prolong\xe9 de 7 jours":"Erreur lors de la prolongation"),n().then(e=>{s(e),d(!1)})},N=async()=>{m&&(d(!0),o(await i(m,h)?"Essai bloqu\xe9":"Erreur lors du blocage"),b(""),p(""),n().then(e=>{s(e),d(!1)}))},y=e.filter(e=>{var s,a;return(null==(a=e.user)||null==(s=a.username)?void 0:s.toLowerCase().includes(x.toLowerCase()))||e.remainingDays.toString().includes(x)});return(0,t.jsxs)("main",{className:"max-w-4xl mx-auto p-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Gestion des p\xe9riodes d’essai"}),(0,t.jsx)("div",{className:"flex items-center mb-4 gap-2",children:(0,t.jsx)("input",{type:"text",placeholder:"Filtrer par utilisateur ou jours restants...",value:x,onChange:e=>u(e.target.value),className:"border px-2 py-1 rounded w-64"})}),c&&(0,t.jsx)("div",{className:"mb-2 text-green-700 font-semibold",children:c}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full border rounded shadow",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-100",children:[(0,t.jsx)("th",{className:"px-3 py-2",children:"Utilisateur"}),(0,t.jsx)("th",{className:"px-3 py-2",children:"Jours restants"}),(0,t.jsx)("th",{className:"px-3 py-2",children:"Extensions"}),(0,t.jsx)("th",{className:"px-3 py-2",children:"Blocage"}),(0,t.jsx)("th",{className:"px-3 py-2",children:"Actions"})]})}),(0,t.jsx)("tbody",{children:a?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"text-center p-4",children:"Chargement..."})}):0===y.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"text-center p-4",children:"Aucun essai"})}):y.map(e=>{var s;return(0,t.jsxs)("tr",{className:"border-b",children:[(0,t.jsx)("td",{className:"px-3 py-2",children:(null==(s=e.user)?void 0:s.username)||"-"}),(0,t.jsx)("td",{className:"px-3 py-2",children:e.remainingDays}),(0,t.jsxs)("td",{className:"px-3 py-2",children:[e.extensionsGranted," / ",e.maxExtensions]}),(0,t.jsx)("td",{className:"px-3 py-2",children:e.isBlocked?"Oui (".concat(e.blockReason,")"):"Non"}),(0,t.jsxs)("td",{className:"px-3 py-2 flex gap-2",children:[(0,t.jsx)("button",{className:"bg-green-600 text-white px-2 py-1 rounded",onClick:()=>j(e.id),disabled:e.extensionsGranted>=e.maxExtensions||e.isBlocked,children:"Prolonger"}),(0,t.jsx)("button",{className:"bg-red-600 text-white px-2 py-1 rounded",onClick:()=>{b(e.id)},disabled:e.isBlocked,children:"Bloquer"})]})]},e.id)})})]})}),m&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-md",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Bloquer la p\xe9riode d’essai"}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),N()},className:"flex flex-col gap-2",children:[(0,t.jsx)("input",{type:"text",placeholder:"Raison du blocage",value:h,onChange:e=>p(e.target.value),required:!0,className:"border px-2 py-1 rounded"}),(0,t.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,t.jsx)("button",{type:"submit",className:"bg-red-600 text-white px-4 py-2 rounded",children:"Bloquer"}),(0,t.jsx)("button",{type:"button",className:"bg-gray-400 text-white px-4 py-2 rounded",onClick:()=>{b(""),p("")},children:"Annuler"})]})]})]})})]})}},6722:(e,s,a)=>{Promise.resolve().then(a.bind(a,4887))}},e=>{var s=s=>e(e.s=s);e.O(0,[8441,1684,7358],()=>s(6722)),_N_E=e.O()}]);