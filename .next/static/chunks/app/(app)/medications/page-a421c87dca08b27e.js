(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2460],{134:(e,r,t)=>{Promise.resolve().then(t.bind(t,3219)),Promise.resolve().then(t.bind(t,9931))},285:(e,r,t)=>{"use strict";t.d(r,{$:()=>c});var a=t(5155);t(2115);var i=t(9708),s=t(2085),n=t(9434);let l=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function c(e){let{className:r,variant:t,size:s,asChild:c=!1,...o}=e,d=c?i.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,n.cn)(l({variant:t,size:s,className:r})),...o})}},968:(e,r,t)=>{"use strict";t.d(r,{b:()=>l});var a=t(2115),i=t(3655),s=t(5155),n=a.forwardRef((e,r)=>(0,s.jsx)(i.sG.label,{...e,ref:r,onMouseDown:r=>{var t;r.target.closest("button, input, select, textarea")||(null==(t=e.onMouseDown)||t.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));n.displayName="Label";var l=n},1154:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(9946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2523:(e,r,t)=>{"use strict";t.d(r,{p:()=>s});var a=t(5155);t(2115);var i=t(9434);function s(e){let{className:r,type:t,...s}=e;return(0,a.jsx)("input",{type:t,"data-slot":"input",className:(0,i.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",r),...s})}},3219:(e,r,t)=>{"use strict";t.d(r,{MedicationsList:()=>F});var a=t(5155),i=t(2115),s=t(2523),n=t(5127),l=t(4477);let c=(0,l.createServerReference)("6022e33785246db056f3cfeaea855ddf89516f7680",l.callServer,void 0,l.findSourceMapURL,"updateMedication");var o=t(7218);let d=(0,l.createServerReference)("40dd257d5c6868eb2129fc3d966498ee319e4f0f5f",l.callServer,void 0,l.findSourceMapURL,"deleteMedication");var u=t(285),m=t(9491),x=t(9434),p=t(4165),h=t(2177),f=t(221),v=t(2531),j=t(7759);let g=v.Ik({name:v.Yj().min(1,"Le nom est requis"),pharmaceuticalForm:v.Yj().min(1,"La forme pharmaceutique est requise"),purchasePrice:v.ai().min(0,"Le prix d'achat doit \xeatre positif"),price:v.ai().min(0,"Le prix doit \xeatre positif"),quantity:v.ai().int().min(0,"La quantit\xe9 doit \xeatre un entier positif"),expirationDate:v.Yj().refine(e=>!isNaN(Date.parse(e)),{message:"Date invalide"}),barcode:v.Yj().optional(),isAvailableForSale:v.zM().default(!1)});function b(e){var r;let{onSubmit:t,medication:i}=e,n=(0,h.mN)({resolver:(0,f.u)(g),defaultValues:{name:(null==i?void 0:i.name)||"",pharmaceuticalForm:(null==i?void 0:i.pharmaceuticalForm)||"",purchasePrice:(null==i?void 0:i.purchasePrice)||0,price:(null==i?void 0:i.price)||0,quantity:(null==i?void 0:i.quantity)||0,expirationDate:i?new Date(i.expirationDate).toISOString().split("T")[0]:"",barcode:(null==i?void 0:i.barcode)||"",isAvailableForSale:null!=(r=null==i?void 0:i.isAvailableForSale)&&r}});return(0,a.jsx)(j.lV,{...n,children:(0,a.jsxs)("form",{onSubmit:n.handleSubmit(e=>{t({...e,expirationDate:new Date(e.expirationDate).toISOString(),purchasePrice:Number(e.purchasePrice),price:Number(e.price)})}),className:"space-y-4",children:[(0,a.jsx)(j.zB,{control:n.control,name:"name",render:e=>{let{field:r}=e;return(0,a.jsxs)(j.eI,{children:[(0,a.jsx)(j.lR,{children:"Nom"}),(0,a.jsx)(j.MJ,{children:(0,a.jsx)(s.p,{placeholder:"Nom du m\xe9dicament",...r})}),(0,a.jsx)(j.C5,{})]})}}),(0,a.jsx)(j.zB,{control:n.control,name:"pharmaceuticalForm",render:e=>{let{field:r}=e;return(0,a.jsxs)(j.eI,{children:[(0,a.jsx)(j.lR,{children:"Forme pharmaceutique"}),(0,a.jsx)(j.MJ,{children:(0,a.jsx)(s.p,{placeholder:"Comprim\xe9, Sirop, etc.",...r})}),(0,a.jsx)(j.C5,{})]})}}),(0,a.jsx)(j.zB,{control:n.control,name:"purchasePrice",render:e=>{let{field:r}=e;return(0,a.jsxs)(j.eI,{children:[(0,a.jsx)(j.lR,{children:"Prix d'achat"}),(0,a.jsx)(j.MJ,{children:(0,a.jsx)(s.p,{type:"number",placeholder:"Prix d'achat",...r,value:r.value})}),(0,a.jsx)(j.C5,{})]})}}),(0,a.jsx)(j.zB,{control:n.control,name:"price",render:e=>{let{field:r}=e;return(0,a.jsxs)(j.eI,{children:[(0,a.jsx)(j.lR,{children:"Prix"}),(0,a.jsx)(j.MJ,{children:(0,a.jsx)(s.p,{type:"number",placeholder:"Prix",...r,value:r.value})}),(0,a.jsx)(j.C5,{})]})}}),(0,a.jsx)(j.zB,{control:n.control,name:"quantity",render:e=>{let{field:r}=e;return(0,a.jsxs)(j.eI,{children:[(0,a.jsx)(j.lR,{children:"Quantit\xe9"}),(0,a.jsx)(j.MJ,{children:(0,a.jsx)(s.p,{type:"number",placeholder:"Quantit\xe9",...r,value:r.value})}),(0,a.jsx)(j.C5,{})]})}}),(0,a.jsx)(j.zB,{control:n.control,name:"expirationDate",render:e=>{let{field:r}=e;return(0,a.jsxs)(j.eI,{children:[(0,a.jsx)(j.lR,{children:"Date d'expiration"}),(0,a.jsx)(j.MJ,{children:(0,a.jsx)(s.p,{type:"date",...r})}),(0,a.jsx)(j.C5,{})]})}}),(0,a.jsx)(j.zB,{control:n.control,name:"barcode",render:e=>{var r;let{field:t}=e;return(0,a.jsxs)(j.eI,{children:[(0,a.jsx)(j.lR,{children:"Code-barres"}),(0,a.jsx)(j.MJ,{children:(0,a.jsx)(s.p,{placeholder:"Code-barres",...t,value:null!=(r=t.value)?r:""})}),(0,a.jsx)(j.C5,{})]})}}),(0,a.jsx)(j.zB,{control:n.control,name:"isAvailableForSale",render:e=>{var r;let{field:t}=e;return(0,a.jsxs)(j.eI,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,a.jsx)(j.MJ,{children:(0,a.jsx)("input",{type:"checkbox",checked:null!=(r=t.value)&&r,onChange:e=>t.onChange(e.target.checked),className:"mt-2"})}),(0,a.jsx)("div",{className:"space-y-1 leading-none",children:(0,a.jsx)(j.lR,{children:"Disponible \xe0 la vente"})})]})}}),(0,a.jsx)(u.$,{type:"submit",children:"Enregistrer"})]})})}var N=t(6671),y=t(2108),w=t(8539),S=t(9946);let C=(0,S.A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),k=(0,S.A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);function F(e){var r;let{exchangeRate:t}=e,[l,h]=(0,i.useState)([]),[f,v]=(0,i.useState)(""),{addItem:j}=(0,m.x)(),[g,S]=(0,i.useState)(!1),[F,D]=(0,i.useState)(null),[M,A]=(0,i.useState)(!1),[R,I]=(0,i.useState)(""),[z,P]=(0,i.useState)(!1),{data:q}=(0,y.useSession)(),L=(null==q||null==(r=q.user)?void 0:r.role)==="admin",E=(0,i.useCallback)(async e=>{P(!0);try{let r=new URLSearchParams;e&&e.trim()&&r.append("search",e.trim());let t="/api/medications".concat(r.toString()?"?"+r.toString():""),a=await fetch(t,{credentials:"include",cache:"no-store"});if(a.ok){let e=await a.json(),r=Array.isArray(e)?e:e.medications||[];h(r)}else{(401===a.status||403===a.status)&&N.oR.error("Session expir\xe9e. Veuillez vous reconnecter.");let e=await a.text().catch(()=>"");console.error("Erreur lors du chargement des m\xe9dicaments:",a.status,a.statusText,e),h([])}}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration des m\xe9dicaments:",e),N.oR.error("Impossible de charger les m\xe9dicaments."),h([])}finally{P(!1)}},[]),_=()=>{window.dispatchEvent(new CustomEvent("medications:updated"))};(0,i.useEffect)(()=>{E()},[E]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{E(f)},300);return()=>clearTimeout(e)},[E,f]),(0,i.useEffect)(()=>{let e=()=>{E(f)};return window.addEventListener("medications:updated",e),()=>{window.removeEventListener("medications:updated",e)}},[E,f]);let J=l.sort((e,r)=>e.name.localeCompare(r.name)),U=e=>{j(e,1),console.log("M\xe9dicament ajout\xe9 au panier:",e)},O=async e=>{let r={...e,expirationDate:new Date(e.expirationDate).toISOString(),purchasePrice:Number(e.purchasePrice),price:Number(e.price),isAvailableForSale:!!e.isAvailableForSale,quantity:Number(e.quantity),barcode:e.barcode?String(e.barcode).trim():null,purchasePriceUsd:(0,x.M_)(Number(e.purchasePrice),t||void 0),priceUsd:(0,x.M_)(Number(e.price),t||void 0)};F?(await c(F.id,r),N.oR.success("M\xe9dicament mis \xe0 jour avec succ\xe8s!")):(await (0,o.U)(r),N.oR.success("M\xe9dicament ajout\xe9 avec succ\xe8s!")),await E(f),_(),S(!1),D(null)},$=async e=>{window.confirm("\xcates-vous s\xfbr de vouloir supprimer ce m\xe9dicament ?")&&(await d(e),N.oR.success("M\xe9dicament supprim\xe9 avec succ\xe8s!"),await E(f),_())},B=async()=>{if(!R.trim())return void N.oR.error("Veuillez saisir une liste de m\xe9dicaments");try{let e=R.split("\n").filter(e=>e.trim()),r=0,t=0;for(let a of e)try{let e=a.split("|").map(e=>e.trim());if(e.length>=6){let[i,s,n,l,c,d]=e;if(!i||!s||isNaN(Number(n))||isNaN(Number(l))||isNaN(Number(c)))t++,console.warn("Ligne ignor\xe9e (donn\xe9es invalides): ".concat(a));else{let e={name:i,pharmaceuticalForm:s,purchasePrice:Number(n),price:Number(l),quantity:Number(c),expirationDate:new Date(d),barcode:"",isAvailableForSale:!1};await (0,o.U)(e),r++}}else t++,console.warn("Ligne ignor\xe9e (format incorrect): ".concat(a))}catch(e){t++,console.error("Erreur lors de l'ajout du m\xe9dicament: ".concat(a),e)}await E(f),A(!1),I(""),r>0&&N.oR.success("".concat(r," m\xe9dicament(s) import\xe9(s) avec succ\xe8s!")),t>0&&N.oR.warning("".concat(t," ligne(s) ignor\xe9e(s) (format incorrect ou donn\xe9es invalides)"))}catch(e){console.error("Erreur lors de l'import:",e),N.oR.error("Erreur lors de l'import des m\xe9dicaments")}};return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)(s.p,{placeholder:"Rechercher un m\xe9dicament par nom ou code-barres...",value:f,onChange:e=>v(e.target.value),className:"max-w-sm"})}),L&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(p.lG,{open:M,onOpenChange:A,children:[(0,a.jsx)(p.zM,{asChild:!0,children:(0,a.jsxs)(u.$,{variant:"outline",className:"flex items-center space-x-2 cursor-pointer",children:[(0,a.jsx)(C,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Importer"})]})}),(0,a.jsxs)(p.Cf,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(p.c7,{children:(0,a.jsxs)(p.L3,{className:"flex items-center space-x-2",children:[(0,a.jsx)(k,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Importer une liste de m\xe9dicaments"})]})}),(0,a.jsxs)("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto pr-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["Format requis : ",(0,a.jsx)("code",{children:"Nom | Forme | Prix d'achat | Prix de vente | Quantit\xe9 | Date d'expiration"})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mb-3",children:["Exemple : ",(0,a.jsx)("code",{children:"Parac\xe9tamol | Comprim\xe9 | 100 | 150 | 50 | 2025-12-31"})]})]}),(0,a.jsx)(w.T,{placeholder:"Collez votre liste de m\xe9dicaments ici...",value:R,onChange:e=>I(e.target.value),rows:10,className:"font-mono text-sm"}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(u.$,{variant:"outline",onClick:()=>A(!1),className:"cursor-pointer",children:"Annuler"}),(0,a.jsx)(u.$,{onClick:B,className:"cursor-pointer",children:"Importer les m\xe9dicaments"})]})]})]})]}),(0,a.jsxs)(p.lG,{open:g,onOpenChange:S,children:[(0,a.jsx)(p.zM,{asChild:!0,children:(0,a.jsx)(u.$,{onClick:()=>D(null),className:"cursor-pointer",children:"Ajouter un m\xe9dicament"})}),(0,a.jsxs)(p.Cf,{className:"max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(p.c7,{children:(0,a.jsx)(p.L3,{children:F?"Modifier le m\xe9dicament":"Ajouter un m\xe9dicament"})}),(0,a.jsx)("div",{className:"max-h-[70vh] overflow-y-auto pr-2",children:(0,a.jsx)(b,{onSubmit:O,medication:F})})]})]})]})]}),(0,a.jsxs)(n.XI,{children:[(0,a.jsx)(n.A0,{children:(0,a.jsxs)(n.Hj,{children:[(0,a.jsx)(n.nd,{children:"Nom"}),(0,a.jsx)(n.nd,{children:"Prix (CDF)"}),(0,a.jsx)(n.nd,{children:"Prix (USD)"}),(0,a.jsx)(n.nd,{children:"Quantit\xe9"}),(0,a.jsx)(n.nd,{children:"Date d'expiration"}),(0,a.jsx)(n.nd,{})]})}),(0,a.jsx)(n.BF,{children:J.map(e=>(0,a.jsxs)(n.Hj,{children:[(0,a.jsx)(n.nA,{children:e.name}),(0,a.jsx)(n.nA,{children:(0,x.vv)(e.price)}),(0,a.jsx)(n.nA,{children:(0,x.vv)((0,x.M_)(e.price,t||void 0),"USD")}),(0,a.jsx)(n.nA,{children:e.quantity}),(0,a.jsx)(n.nA,{children:new Date(e.expirationDate).toLocaleDateString()}),(0,a.jsxs)(n.nA,{children:[(0,a.jsx)(u.$,{onClick:()=>{console.log("Bouton Ajouter au panier cliqu\xe9"),U(e)},className:"cursor-pointer",children:"Ajouter au panier"}),L&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>{D(e),S(!0)},className:"ml-2 cursor-pointer",children:"Modifier"}),(0,a.jsx)(u.$,{variant:"destructive",size:"sm",onClick:()=>$(e.id),className:"ml-2 cursor-pointer",children:"Supprimer"})]})]})]},e.id))})]})]})}},4165:(e,r,t)=>{"use strict";t.d(r,{Cf:()=>u,Es:()=>x,L3:()=>p,c7:()=>m,lG:()=>l,rr:()=>h,zM:()=>c});var a=t(5155);t(2115);var i=t(5452),s=t(4416),n=t(9434);function l(e){let{...r}=e;return(0,a.jsx)(i.bL,{"data-slot":"dialog",...r})}function c(e){let{...r}=e;return(0,a.jsx)(i.l9,{"data-slot":"dialog-trigger",...r})}function o(e){let{...r}=e;return(0,a.jsx)(i.ZL,{"data-slot":"dialog-portal",...r})}function d(e){let{className:r,...t}=e;return(0,a.jsx)(i.hJ,{"data-slot":"dialog-overlay",className:(0,n.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",r),...t})}function u(e){let{className:r,children:t,showCloseButton:l=!0,...c}=e;return(0,a.jsxs)(o,{"data-slot":"dialog-portal",children:[(0,a.jsx)(d,{}),(0,a.jsxs)(i.UC,{"data-slot":"dialog-content",className:(0,n.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",r),...c,children:[t,l&&(0,a.jsxs)(i.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(s.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:r,...t}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,n.cn)("flex flex-col gap-2 text-center sm:text-left",r),...t})}function x(e){let{className:r,...t}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,n.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",r),...t})}function p(e){let{className:r,...t}=e;return(0,a.jsx)(i.hE,{"data-slot":"dialog-title",className:(0,n.cn)("text-lg leading-none font-semibold",r),...t})}function h(e){let{className:r,...t}=e;return(0,a.jsx)(i.VY,{"data-slot":"dialog-description",className:(0,n.cn)("text-muted-foreground text-sm",r),...t})}},4477:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),!function(e,r){for(var t in r)Object.defineProperty(e,t,{enumerable:!0,get:r[t]})}(r,{callServer:function(){return a.callServer},createServerReference:function(){return s},findSourceMapURL:function(){return i.findSourceMapURL}});let a=t(3806),i=t(1818),s=t(4979).createServerReference},5057:(e,r,t)=>{"use strict";t.d(r,{J:()=>n});var a=t(5155);t(2115);var i=t(968),s=t(9434);function n(e){let{className:r,...t}=e;return(0,a.jsx)(i.b,{"data-slot":"label",className:(0,s.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",r),...t})}},5127:(e,r,t)=>{"use strict";t.d(r,{A0:()=>n,BF:()=>l,Hj:()=>c,XI:()=>s,nA:()=>d,nd:()=>o});var a=t(5155);t(2115);var i=t(9434);function s(e){let{className:r,...t}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,i.cn)("w-full caption-bottom text-sm",r),...t})})}function n(e){let{className:r,...t}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,i.cn)("[&_tr]:border-b",r),...t})}function l(e){let{className:r,...t}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,i.cn)("[&_tr:last-child]:border-0",r),...t})}function c(e){let{className:r,...t}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,i.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",r),...t})}function o(e){let{className:r,...t}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,i.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",r),...t})}function d(e){let{className:r,...t}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,i.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",r),...t})}},7218:(e,r,t)=>{"use strict";t.d(r,{U:()=>i});var a=t(4477);let i=(0,a.createServerReference)("4043f4080d359601059ceba5592fffea9b0ee6cd7e",a.callServer,void 0,a.findSourceMapURL,"createMedication")},7759:(e,r,t)=>{"use strict";t.d(r,{C5:()=>v,MJ:()=>f,eI:()=>p,lR:()=>h,lV:()=>o,zB:()=>u});var a=t(5155),i=t(2115),s=t(9708),n=t(2177),l=t(9434),c=t(5057);let o=n.Op,d=i.createContext({}),u=e=>{let{...r}=e;return(0,a.jsx)(d.Provider,{value:{name:r.name},children:(0,a.jsx)(n.xI,{...r})})},m=()=>{let e=i.useContext(d),r=i.useContext(x),{getFieldState:t,formState:a}=(0,n.xW)(),s=t(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=r;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...s}},x=i.createContext({}),p=i.forwardRef((e,r)=>{let{className:t,...s}=e,n=i.useId();return(0,a.jsx)(x.Provider,{value:{id:n},children:(0,a.jsx)("div",{ref:r,className:(0,l.cn)("space-y-2",t),...s})})});p.displayName="FormItem";let h=i.forwardRef((e,r)=>{let{className:t,...i}=e,{error:s,formItemId:n}=m();return(0,a.jsx)(c.J,{ref:r,className:(0,l.cn)(s&&"text-destructive",t),htmlFor:n,...i})});h.displayName="FormLabel";let f=i.forwardRef((e,r)=>{let{...t}=e,{error:i,formItemId:n,formDescriptionId:l,formMessageId:c}=m();return(0,a.jsx)(s.DX,{ref:r,id:n,"aria-describedby":i?"".concat(l," ").concat(c):"".concat(l),"aria-invalid":!!i,...t})});f.displayName="FormControl",i.forwardRef((e,r)=>{let{className:t,...i}=e,{formDescriptionId:s}=m();return(0,a.jsx)("p",{ref:r,id:s,className:(0,l.cn)("text-sm text-muted-foreground",t),...i})}).displayName="FormDescription";let v=i.forwardRef((e,r)=>{let{className:t,children:i,...s}=e,{error:n,formMessageId:c}=m(),o=n?String(null==n?void 0:n.message):i;return o?(0,a.jsx)("p",{ref:r,id:c,className:(0,l.cn)("text-sm font-medium text-destructive",t),...s,children:o}):null});v.displayName="FormMessage"},7809:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(9946).A)("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},8539:(e,r,t)=>{"use strict";t.d(r,{T:()=>n});var a=t(5155),i=t(2115),s=t(9434);let n=i.forwardRef((e,r)=>{let{className:t,...i}=e;return(0,a.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...i})});n.displayName="Textarea"},9434:(e,r,t)=>{"use strict";t.d(r,{M_:()=>l,cn:()=>s,vv:()=>n});var a=t(2596),i=t(9688);function s(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,i.QP)((0,a.$)(r))}function n(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CDF",t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=new Intl.NumberFormat("fr-CD",{minimumFractionDigits:0,maximumFractionDigits:0}).format(e);if("CDF"===r)return"".concat(a).concat(t?" CDF":"");if("USD"===r){let r=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e);return"".concat(r).concat(t?" USD":"")}return a}function l(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2400;return e/r}},9491:(e,r,t)=>{"use strict";t.d(r,{x:()=>c});var a=t(2115);let i=e=>{let r,t=new Set,a=(e,a)=>{let i="function"==typeof e?e(r):e;if(!Object.is(i,r)){let e=r;r=(null!=a?a:"object"!=typeof i||null===i)?i:Object.assign({},r,i),t.forEach(t=>t(r,e))}},i=()=>r,s={setState:a,getState:i,getInitialState:()=>n,subscribe:e=>(t.add(e),()=>t.delete(e))},n=r=e(a,i,s);return s},s=e=>e?i(e):i,n=e=>e,l=e=>{let r=s(e),t=e=>(function(e,r=n){let t=a.useSyncExternalStore(e.subscribe,()=>r(e.getState()),()=>r(e.getInitialState()));return a.useDebugValue(t),t})(r,e);return Object.assign(t,r),t},c=(e=>e?l(e):l)(e=>({items:[],addItem:(r,t)=>e(e=>e.items.find(e=>e.id===r.id)?{items:e.items.map(e=>e.id===r.id?{...e,quantityInCart:e.quantityInCart+t}:e)}:{items:[...e.items,{...r,quantityInCart:t}]}),removeItem:r=>e(e=>({items:e.items.filter(e=>e.id!==r)})),updateItemQuantity:(r,t)=>e(e=>({items:e.items.map(e=>e.id===r?{...e,quantityInCart:t}:e)})),clearCart:()=>e({items:[]})}))},9931:(e,r,t)=>{"use strict";t.d(r,{ReferenceMedicationsTable:()=>g});var a=t(5155),i=t(2115),s=t(5127),n=t(285),l=t(2523),c=t(4165),o=t(5057),d=t(6671),u=t(7218),m=t(9434);let x=(0,t(9946).A)("package-plus",[["path",{d:"M16 16h6",key:"100bgy"}],["path",{d:"M19 13v6",key:"85cyf1"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]);var p=t(7809),h=t(1154);let f={name:"",pharmaceuticalForm:"",purchasePrice:"",price:"",quantity:"0",expirationDate:"",barcode:"",isAvailableForSale:!1};function v(e){if(!e)return"";let r=Date.parse(e);if(!Number.isNaN(r))return new Date(r).toISOString().split("T")[0];let[t,a,i]=e.split(/[\/\-]/);if(t&&a&&i){let e=Date.parse("".concat(2===i.length?"20".concat(i):i,"-").concat(a.padStart(2,"0"),"-").concat(t.padStart(2,"0")));if(!Number.isNaN(e))return new Date(e).toISOString().split("T")[0]}let s=new Date;return s.setMonth(s.getMonth()+12),s.toISOString().split("T")[0]}function j(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("number"==typeof e)return Number.isFinite(e)?e:r;let t=Number(e.replace(",",".").trim());return Number.isFinite(t)?t:r}function g(e){let{data:r,exchangeRate:t}=e,[g,b]=(0,i.useState)(""),[N,y]=(0,i.useState)(!1),[w,S]=(0,i.useState)(f),[C,k]=(0,i.useTransition)(),[F,D]=(0,i.useState)("stock"),M=(0,i.useMemo)(()=>{if(!g.trim())return r;let e=g.trim().toLowerCase();return r.filter(r=>r.name.toLowerCase().includes(e)||r.form.toLowerCase().includes(e))},[r,g]),A=(e,r)=>{S({name:e.name,pharmaceuticalForm:e.form,purchasePrice:String(j(e.price,0)),price:String(j(e.price,0)),quantity:String(Math.max(0,Math.trunc(j(e.stock,0)))),expirationDate:v(e.expirationDate),barcode:"",isAvailableForSale:"available"===r}),D(r),y(!0)},R=e=>r=>{let t="isAvailableForSale"===e?r.target.checked:r.target.value;S(r=>({...r,[e]:t}))};return r.length?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Liste de r\xe9f\xe9rence (500 m\xe9dicaments)"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ajoutez rapidement une r\xe9f\xe9rence au stock ou aux produits disponibles."})]}),(0,a.jsx)(l.p,{placeholder:"Rechercher par nom ou forme pharmaceutique...",value:g,onChange:e=>b(e.target.value),className:"max-w-sm"})]}),(0,a.jsx)("div",{className:"max-h-[30rem] overflow-y-auto rounded-lg border bg-white shadow-sm",children:(0,a.jsxs)(s.XI,{children:[(0,a.jsx)(s.A0,{className:"sticky top-0 bg-white",children:(0,a.jsxs)(s.Hj,{children:[(0,a.jsx)(s.nd,{children:"M\xe9dicament"}),(0,a.jsx)(s.nd,{children:"Forme"}),(0,a.jsx)(s.nd,{className:"text-right",children:"Prix r\xe9f. (CDF)"}),(0,a.jsx)(s.nd,{className:"text-right",children:"Prix r\xe9f. (USD)"}),(0,a.jsx)(s.nd,{children:"Date d'expiration"}),(0,a.jsx)(s.nd,{className:"text-right",children:"Stock sugg\xe9r\xe9"}),(0,a.jsx)(s.nd,{children:"Actions"})]})}),(0,a.jsxs)(s.BF,{children:[M.map(e=>{let r=(0,m.M_)(e.price,t||void 0);return(0,a.jsxs)(s.Hj,{children:[(0,a.jsx)(s.nA,{className:"font-medium",children:e.name}),(0,a.jsx)(s.nA,{children:e.form}),(0,a.jsx)(s.nA,{className:"text-right",children:(0,m.vv)(e.price)}),(0,a.jsx)(s.nA,{className:"text-right",children:(0,m.vv)(r,"USD")}),(0,a.jsx)(s.nA,{children:e.expirationDate||"N/A"}),(0,a.jsx)(s.nA,{className:"text-right",children:e.stock}),(0,a.jsx)(s.nA,{children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsxs)(n.$,{variant:"outline",size:"sm",className:"cursor-pointer",onClick:()=>A(e,"stock"),children:[(0,a.jsx)(x,{className:"mr-2 h-4 w-4"})," Stock"]}),(0,a.jsxs)(n.$,{size:"sm",className:"cursor-pointer",onClick:()=>A(e,"available"),children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"})," Mettre en vente"]})]})})]},e.id)}),0===M.length&&(0,a.jsx)(s.Hj,{children:(0,a.jsx)(s.nA,{colSpan:7,className:"py-6 text-center text-sm text-muted-foreground",children:"Aucun m\xe9dicament trouv\xe9 pour cette recherche."})})]})]})}),(0,a.jsx)(c.lG,{open:N,onOpenChange:y,children:(0,a.jsxs)(c.Cf,{className:"max-w-xl",children:[(0,a.jsxs)(c.c7,{children:[(0,a.jsx)(c.L3,{children:"available"===F?"Publier ce m\xe9dicament":"Ajouter au stock"}),(0,a.jsx)(c.rr,{children:"Compl\xe9tez les informations avant de transf\xe9rer la r\xe9f\xe9rence s\xe9lectionn\xe9e."})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(o.J,{htmlFor:"ref-name",children:"Nom"}),(0,a.jsx)(l.p,{id:"ref-name",value:w.name,onChange:R("name"),placeholder:"Nom du m\xe9dicament"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(o.J,{htmlFor:"ref-form",children:"Forme pharmaceutique"}),(0,a.jsx)(l.p,{id:"ref-form",value:w.pharmaceuticalForm,onChange:R("pharmaceuticalForm"),placeholder:"Comprim\xe9, sirop, etc."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(o.J,{htmlFor:"ref-purchase",children:"Prix d'achat (CDF)"}),(0,a.jsx)(l.p,{id:"ref-purchase",type:"number",value:w.purchasePrice,onChange:R("purchasePrice"),min:0})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(o.J,{htmlFor:"ref-price",children:"Prix de vente (CDF)"}),(0,a.jsx)(l.p,{id:"ref-price",type:"number",value:w.price,onChange:R("price"),min:0,required:!0})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(o.J,{htmlFor:"ref-quantity",children:"Quantit\xe9 initiale"}),(0,a.jsx)(l.p,{id:"ref-quantity",type:"number",value:w.quantity,onChange:R("quantity"),min:0})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(o.J,{htmlFor:"ref-expiration",children:"Date d'expiration"}),(0,a.jsx)(l.p,{id:"ref-expiration",type:"date",value:w.expirationDate,onChange:R("expirationDate")})]})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(o.J,{htmlFor:"ref-barcode",children:"Code-barres (optionnel)"}),(0,a.jsx)(l.p,{id:"ref-barcode",value:w.barcode,onChange:R("barcode"),placeholder:"Scannez ou saisissez un code-barres"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{id:"ref-available",type:"checkbox",checked:w.isAvailableForSale,onChange:R("isAvailableForSale")}),(0,a.jsx)(o.J,{htmlFor:"ref-available",children:"Rendre disponible \xe0 la vente imm\xe9diatement"})]})]}),(0,a.jsxs)(c.Es,{children:[(0,a.jsx)(n.$,{variant:"outline",onClick:()=>y(!1),className:"cursor-pointer",disabled:C,children:"Annuler"}),(0,a.jsx)(n.$,{onClick:()=>{k(async()=>{try{let e=w.name.trim(),r=w.pharmaceuticalForm.trim()||"Non pr\xe9cis\xe9",a=j(w.purchasePrice,0),i=j(w.price,0),s=Math.max(0,Math.trunc(j(w.quantity,0))),n=w.expirationDate||v(""),l=w.barcode.trim();if(!e)return void d.oR.error("Le nom du m\xe9dicament est requis.");if(i<=0)return void d.oR.error("Le prix de vente doit \xeatre sup\xe9rieur \xe0 0.");let c=(0,m.M_)(i,t||void 0),o=(0,m.M_)(a,t||void 0);await (0,u.U)({name:e,pharmaceuticalForm:r,purchasePrice:a,purchasePriceUsd:o,price:i,priceUsd:c,quantity:s,expirationDate:new Date(n),barcode:l||null,isAvailableForSale:w.isAvailableForSale}),window.dispatchEvent(new CustomEvent("medications:updated")),d.oR.success(w.isAvailableForSale?"M\xe9dicament transf\xe9r\xe9 vers les produits disponibles.":"M\xe9dicament transf\xe9r\xe9 vers le stock."),y(!1),S(f)}catch(e){console.error("Erreur lors du transfert du m\xe9dicament:",e),d.oR.error("Impossible de transf\xe9rer le m\xe9dicament.")}})},disabled:C,className:"cursor-pointer",children:C?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Traitement..."]}):"Confirmer le transfert"})]})]})})]}):(0,a.jsx)("div",{className:"rounded-lg border border-dashed border-slate-300 bg-slate-50 p-6 text-sm text-slate-600",children:"Aucune donn\xe9e de r\xe9f\xe9rence n'a pu \xeatre charg\xe9e."})}}},e=>{var r=r=>e(e.s=r);e.O(0,[9039,7471,2108,8595,1071,1807,8441,1684,7358],()=>r(134)),_N_E=e.O()}]);