(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4776],{285:(e,t,r)=>{"use strict";r.d(t,{$:()=>d});var a=r(5155);r(2115);var n=r(9708),s=r(2085),i=r(9434);let l=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:t,variant:r,size:s,asChild:d=!1,...o}=e,c=d?n.DX:"button";return(0,a.jsx)(c,{"data-slot":"button",className:(0,i.cn)(l({variant:r,size:s,className:t})),...o})}},968:(e,t,r)=>{"use strict";r.d(t,{b:()=>l});var a=r(2115),n=r(3655),s=r(5155),i=a.forwardRef((e,t)=>(0,s.jsx)(n.sG.label,{...e,ref:t,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||(null==(r=e.onMouseDown)||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=i},2523:(e,t,r)=>{"use strict";r.d(t,{p:()=>s});var a=r(5155);r(2115);var n=r(9434);function s(e){let{className:t,type:r,...s}=e;return(0,a.jsx)("input",{type:r,"data-slot":"input",className:(0,n.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s})}},3655:(e,t,r)=>{"use strict";r.d(t,{hO:()=>d,sG:()=>l});var a=r(2115),n=r(7650),s=r(9708),i=r(5155),l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=(0,s.TL)(`Primitive.${t}`),n=a.forwardRef((e,a)=>{let{asChild:n,...s}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(n?r:t,{...s,ref:a})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function d(e,t){e&&n.flushSync(()=>e.dispatchEvent(t))}},4477:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{callServer:function(){return a.callServer},createServerReference:function(){return s},findSourceMapURL:function(){return n.findSourceMapURL}});let a=r(3806),n=r(1818),s=r(4979).createServerReference},5057:(e,t,r)=>{"use strict";r.d(t,{J:()=>i});var a=r(5155);r(2115);var n=r(968),s=r(9434);function i(e){let{className:t,...r}=e;return(0,a.jsx)(n.b,{"data-slot":"label",className:(0,s.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...r})}},5127:(e,t,r)=>{"use strict";r.d(t,{A0:()=>i,BF:()=>l,Hj:()=>d,XI:()=>s,nA:()=>c,nd:()=>o});var a=r(5155);r(2115);var n=r(9434);function s(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,n.cn)("w-full caption-bottom text-sm",t),...r})})}function i(e){let{className:t,...r}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,n.cn)("[&_tr]:border-b",t),...r})}function l(e){let{className:t,...r}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,n.cn)("[&_tr:last-child]:border-0",t),...r})}function d(e){let{className:t,...r}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,n.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...r})}function o(e){let{className:t,...r}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,n.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}function c(e){let{className:t,...r}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,n.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},5963:(e,t,r)=>{Promise.resolve().then(r.bind(r,9426))},6695:(e,t,r)=>{"use strict";r.d(t,{BT:()=>d,Wu:()=>o,ZB:()=>l,Zp:()=>s,aR:()=>i});var a=r(5155);r(2115);var n=r(9434);function s(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,n.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function i(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,n.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function l(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,n.cn)("leading-none font-semibold",t),...r})}function d(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...r})}function o(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,n.cn)("px-6",t),...r})}},8539:(e,t,r)=>{"use strict";r.d(t,{T:()=>i});var a=r(5155),n=r(2115),s=r(9434);let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,a.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...n})});i.displayName="Textarea"},9426:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var a=r(5155),n=r(2115),s=r(5695),i=r(9491),l=r(285),d=r(2523),o=r(5057),c=r(6695),u=r(5127),m=r(8539),f=r(6671),x=r(4477);let h=(0,x.createServerReference)("7f9b3261f850bfe266b53a123039f8f4ce10c248d1",x.callServer,void 0,x.findSourceMapURL,"createSale");var p=r(9434),v=r(2108);function g(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)(),{items:r,clearCart:x,updateItemQuantity:g}=(0,i.x)(),{data:b}=(0,v.useSession)(),[j,y]=(0,n.useState)(""),[N,w]=(0,n.useState)(""),[S,k]=(0,n.useState)("Nom du Vendeur"),[C,R]=(0,n.useState)(""),[F,D]=(0,n.useState)(""),[I,P]=(0,n.useState)("");(0,n.useEffect)(()=>{var e;let r=t.get("clientName");r&&R(r),(null==b||null==(e=b.user)?void 0:e.name)&&k(b.user.name);let a=new Date,n=a.getFullYear(),s=Math.floor((a.getTime()-new Date(n,0,0).getTime())/1e3/60/60/24),i=Math.floor(1e4*Math.random());y("FCT-".concat(n,"-").concat(String(s).padStart(3,"0")).concat(String(i).padStart(4,"0"))),w(a.toLocaleDateString("fr-FR")),D(a.toLocaleTimeString("fr-FR"))},[t,b]);let A=r.reduce((e,t)=>e+t.price*t.quantityInCart,0),_=async()=>{if(!b)return void f.oR.error("Vous devez \xeatre connect\xe9 pour finaliser la vente.");try{await h(C,0,0,I,r.map(e=>({medicationId:e.id,quantity:e.quantityInCart,priceAtSale:e.price})),A,A,0,"Esp\xe8ces"),f.oR.success("Vente enregistr\xe9e avec succ\xe8s et facture g\xe9n\xe9r\xe9e!"),x(),window.print();try{await Promise.allSettled([fetch("/api/daily-report",{cache:"no-store"}),fetch("/api/sales?today=true",{cache:"no-store"})])}catch(e){}setTimeout(()=>{e.push("/seller-dashboard")},500)}catch(e){console.error("Error finalizing sale:",e),f.oR.error("Erreur lors de la finalisation de la vente.")}};return(0,a.jsxs)("div",{className:"container mx-auto p-4 print:p-0",children:[(0,a.jsxs)(c.Zp,{className:"print:border-none print:shadow-none",children:[(0,a.jsxs)(c.aR,{className:"text-center print:text-left",children:[(0,a.jsx)(c.ZB,{className:"text-2xl font-bold",children:"FACTURE"}),(0,a.jsxs)("div",{className:"text-sm mt-2",children:[(0,a.jsx)("p",{children:(0,a.jsx)("strong",{children:"PAJO PHARMA"})}),(0,a.jsx)("p",{children:"12e Rue Industrielle, Limete, Kinshasa"}),(0,a.jsx)("p",{children:"+243 970 000 000"}),(0,a.jsx)("p",{children:"✉️ contact@pajopharma.cd"})]})]}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Num\xe9ro de Facture:"})," ",j]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Date:"})," ",N]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Vendeur:"})," ",S]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(o.J,{htmlFor:"clientName",children:"Nom du client"}),(0,a.jsx)(d.p,{id:"clientName",value:C,onChange:e=>R(e.target.value)}),(0,a.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg border",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Heure de sortie de la facture:"}),(0,a.jsx)("p",{className:"text-lg font-bold text-blue-600",children:F})]})]})]}),(0,a.jsx)("h3",{className:"text-lg font-bold mb-3",children:"D\xe9tails des Produits"}),(0,a.jsxs)(u.XI,{children:[(0,a.jsx)(u.A0,{children:(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nd,{children:"N\xb0"}),(0,a.jsx)(u.nd,{children:"M\xe9dicament"}),(0,a.jsx)(u.nd,{children:"Quantit\xe9"}),(0,a.jsx)(u.nd,{className:"text-right",children:"Prix Unitaire (CDF)"}),(0,a.jsx)(u.nd,{className:"text-right",children:"Total (CDF)"})]})}),(0,a.jsx)(u.BF,{children:r.map((e,t)=>(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nA,{children:t+1}),(0,a.jsx)(u.nA,{children:e.name}),(0,a.jsx)(u.nA,{children:(0,a.jsx)(d.p,{type:"number",value:e.quantityInCart,onChange:t=>g(e.id,parseInt(t.target.value)||1),className:"w-20",min:"1"})}),(0,a.jsx)(u.nA,{className:"text-right",children:(0,p.vv)(e.price)}),(0,a.jsx)(u.nA,{className:"text-right",children:(0,p.vv)(e.price*e.quantityInCart)})]},e.id))})]}),(0,a.jsx)("div",{className:"mt-6 text-right",children:(0,a.jsxs)("p",{className:"text-xl font-bold",children:["Total: ",(0,p.vv)(A)]})}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)(o.J,{htmlFor:"remarks",children:"Remarques"}),(0,a.jsx)(m.T,{id:"remarks",value:I,onChange:e=>P(e.target.value),placeholder:"Merci d'avoir choisi PAJO PHARMA."})]}),(0,a.jsxs)("div",{className:"mt-6 text-sm text-gray-600 print:text-black",children:[(0,a.jsx)("p",{children:"Cette facture est g\xe9n\xe9r\xe9e par un syst\xe8me agr\xe9\xe9. Elle fait foi de preuve d'achat."}),(0,a.jsx)("p",{children:"Certains m\xe9dicaments peuvent n\xe9cessiter une prescription. Conservez cette facture pour votre dossier m\xe9dical."})]})]})]}),(0,a.jsx)("div",{className:"flex justify-end gap-4 mt-6 print:hidden",children:(0,a.jsx)(l.$,{onClick:_,children:"Finaliser la Vente & Imprimer"})})]})}function b(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{children:"Chargement..."}),children:(0,a.jsx)(g,{})})}},9434:(e,t,r)=>{"use strict";r.d(t,{M_:()=>l,cn:()=>s,vv:()=>i});var a=r(2596),n=r(9688);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.QP)((0,a.$)(t))}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CDF",r=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=new Intl.NumberFormat("fr-CD",{minimumFractionDigits:0,maximumFractionDigits:0}).format(e);if("CDF"===t)return"".concat(a).concat(r?" CDF":"");if("USD"===t){let t=new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e);return"".concat(t).concat(r?" USD":"")}return a}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2400;return e/t}},9491:(e,t,r)=>{"use strict";r.d(t,{x:()=>d});var a=r(2115);let n=e=>{let t,r=new Set,a=(e,a)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=a?a:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach(r=>r(t,e))}},n=()=>t,s={setState:a,getState:n,getInitialState:()=>i,subscribe:e=>(r.add(e),()=>r.delete(e))},i=t=e(a,n,s);return s},s=e=>e?n(e):n,i=e=>e,l=e=>{let t=s(e),r=e=>(function(e,t=i){let r=a.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return a.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},d=(e=>e?l(e):l)(e=>({items:[],addItem:(t,r)=>e(e=>e.items.find(e=>e.id===t.id)?{items:e.items.map(e=>e.id===t.id?{...e,quantityInCart:e.quantityInCart+r}:e)}:{items:[...e.items,{...t,quantityInCart:r}]}),removeItem:t=>e(e=>({items:e.items.filter(e=>e.id!==t)})),updateItemQuantity:(t,r)=>e(e=>({items:e.items.map(e=>e.id===t?{...e,quantityInCart:r}:e)})),clearCart:()=>e({items:[]})}))}},e=>{var t=t=>e(e.s=t);e.O(0,[9039,7471,2108,8441,1684,7358],()=>t(5963)),_N_E=e.O()}]);