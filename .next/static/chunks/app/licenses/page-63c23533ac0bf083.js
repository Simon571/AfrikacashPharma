(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8395],{4435:(e,t,s)=>{Promise.resolve().then(s.bind(s,5518))},5518:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var n=s(5155),a=s(2115);let l=async()=>{let e=await fetch("/api/admin/licenses",{credentials:"include"});if(!e.ok)return console.error("Failed to fetch licenses:",e.status,e.statusText),[];let t=await e.text();return(t?JSON.parse(t):{licenses:[]}).licenses||[]},i=async()=>{let e=await fetch("/api/admin/clients",{credentials:"include"});if(!e.ok)return console.error("Failed to fetch clients:",e.status,e.statusText),[];let t=await e.text();return(t?JSON.parse(t):{clients:[]}).clients||[]},c=async e=>(await fetch("/api/admin/licenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:e}),credentials:"include"})).ok,r=async(e,t)=>(await fetch("/api/admin/licenses/".concat(e,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t}),credentials:"include"})).ok,d=async e=>(await fetch("/api/admin/licenses/".concat(e),{method:"DELETE",credentials:"include"})).ok;function o(){let[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)([]),[u,x]=(0,a.useState)(!0),[h,p]=(0,a.useState)(!1),[m,b]=(0,a.useState)(""),[j,y]=(0,a.useState)(""),[N,f]=(0,a.useState)("");(0,a.useEffect)(()=>{l().then(e=>{t(e),x(!1)}),i().then(o)},[]);let w=async()=>{x(!0),y(await c(m)?"Licence g\xe9n\xe9r\xe9e et attribu\xe9e":"Erreur lors de l'attribution"),p(!1),b(""),l().then(e=>{t(e),x(!1)})},g=async(e,s)=>{x(!0),y(await r(e,s)?"Statut mis \xe0 jour":"Erreur lors de la mise \xe0 jour"),l().then(e=>{t(e),x(!1)})},v=async e=>{x(!0),y(await d(e)?"Licence supprim\xe9e":"Erreur lors de la suppression"),l().then(e=>{t(e),x(!1)})},S=e.filter(e=>{var t,s,n;return(null==(t=e.key)?void 0:t.toLowerCase().includes(N.toLowerCase()))||(null==(n=e.client)||null==(s=n.name)?void 0:s.toLowerCase().includes(N.toLowerCase()))});return(0,n.jsxs)("main",{className:"max-w-4xl mx-auto p-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Gestion des licences"}),(0,n.jsxs)("div",{className:"flex items-center mb-4 gap-2",children:[(0,n.jsx)("input",{type:"text",placeholder:"Filtrer par cl\xe9 ou client...",value:N,onChange:e=>f(e.target.value),className:"border px-2 py-1 rounded w-64"}),(0,n.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:()=>p(!0),children:"G\xe9n\xe9rer une licence"})]}),j&&(0,n.jsx)("div",{className:"mb-2 text-green-700 font-semibold",children:j}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full border rounded shadow",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-100",children:[(0,n.jsx)("th",{className:"px-3 py-2",children:"Cl\xe9"}),(0,n.jsx)("th",{className:"px-3 py-2",children:"Client"}),(0,n.jsx)("th",{className:"px-3 py-2",children:"Statut"}),(0,n.jsx)("th",{className:"px-3 py-2",children:"Attribu\xe9e le"}),(0,n.jsx)("th",{className:"px-3 py-2",children:"Actions"})]})}),(0,n.jsx)("tbody",{children:u?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:5,className:"text-center p-4",children:"Chargement..."})}):0===S.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:5,className:"text-center p-4",children:"Aucune licence"})}):S.map(e=>{var t,s;return(0,n.jsxs)("tr",{className:"border-b",children:[(0,n.jsx)("td",{className:"px-3 py-2 font-mono",children:e.key}),(0,n.jsx)("td",{className:"px-3 py-2",children:(null==(t=e.client)?void 0:t.name)||"-"}),(0,n.jsx)("td",{className:"px-3 py-2",children:e.status}),(0,n.jsx)("td",{className:"px-3 py-2",children:null==(s=e.issuedAt)?void 0:s.slice(0,10)}),(0,n.jsxs)("td",{className:"px-3 py-2 flex gap-2",children:[(0,n.jsx)("button",{className:"bg-yellow-500 text-white px-2 py-1 rounded",onClick:()=>g(e.id,"SUSPENDED"),children:"Suspendre"}),(0,n.jsx)("button",{className:"bg-green-600 text-white px-2 py-1 rounded",onClick:()=>g(e.id,"ACTIVE"),children:"Activer"}),(0,n.jsx)("button",{className:"bg-red-600 text-white px-2 py-1 rounded",onClick:()=>v(e.id),children:"Supprimer"})]})]},e.id)})})]})}),h&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-md",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-4",children:"G\xe9n\xe9rer et attribuer une licence"}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),w()},className:"flex flex-col gap-2",children:[(0,n.jsxs)("select",{value:m,onChange:e=>b(e.target.value),required:!0,className:"border px-2 py-1 rounded",children:[(0,n.jsx)("option",{value:"",children:"S\xe9lectionner un client"}),s.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,n.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"G\xe9n\xe9rer"}),(0,n.jsx)("button",{type:"button",className:"bg-gray-400 text-white px-4 py-2 rounded",onClick:()=>p(!1),children:"Annuler"})]})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8441,1684,7358],()=>t(4435)),_N_E=e.O()}]);