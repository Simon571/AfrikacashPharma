(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7651],{1413:(e,t,a)=>{Promise.resolve().then(a.bind(a,9584))},9584:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var n=a(5155),s=a(2115);let l=async()=>{let e=await fetch("/api/admin/subscriptions",{credentials:"include"});return(await e.json()).subscriptions||[]},r=async()=>{let e=await fetch("/api/admin/clients",{credentials:"include"});return(await e.json()).clients||[]},d=async e=>(await fetch("/api/admin/subscriptions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"})).ok,i=async(e,t)=>(await fetch("/api/admin/subscriptions/".concat(e,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t}),credentials:"include"})).ok,c=async e=>(await fetch("/api/admin/subscriptions/".concat(e),{method:"DELETE",credentials:"include"})).ok;function o(){let[e,t]=(0,s.useState)([]),[a,o]=(0,s.useState)([]),[u,p]=(0,s.useState)(!0),[x,h]=(0,s.useState)(!1),[m,y]=(0,s.useState)({}),[b,j]=(0,s.useState)(""),[N,g]=(0,s.useState)("");(0,s.useEffect)(()=>{l().then(e=>{t(e),p(!1)}),r().then(o)},[]);let v=async()=>{p(!0),j(await d(m)?"Abonnement ajout\xe9":"Erreur lors de l'ajout"),h(!1),y({}),l().then(e=>{t(e),p(!1)})},f=async(e,a)=>{p(!0),j(await i(e,a)?"Statut mis \xe0 jour":"Erreur lors de la mise \xe0 jour"),l().then(e=>{t(e),p(!1)})},w=async e=>{p(!0),j(await c(e)?"Abonnement supprim\xe9":"Erreur lors de la suppression"),l().then(e=>{t(e),p(!1)})},C=e.filter(e=>{var t,a,n;return(null==(a=e.client)||null==(t=a.name)?void 0:t.toLowerCase().includes(N.toLowerCase()))||(null==(n=e.plan)?void 0:n.toLowerCase().includes(N.toLowerCase()))});return(0,n.jsxs)("main",{className:"max-w-4xl mx-auto p-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Gestion des abonnements"}),(0,n.jsxs)("div",{className:"flex items-center mb-4 gap-2",children:[(0,n.jsx)("input",{type:"text",placeholder:"Filtrer par client ou plan...",value:N,onChange:e=>g(e.target.value),className:"border px-2 py-1 rounded w-64"}),(0,n.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:()=>h(!0),children:"Ajouter un abonnement"})]}),b&&(0,n.jsx)("div",{className:"mb-2 text-green-700 font-semibold",children:b}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full border rounded shadow",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-100",children:[(0,n.jsx)("th",{className:"px-3 py-2",children:"Client"}),(0,n.jsx)("th",{className:"px-3 py-2",children:"Plan"}),(0,n.jsx)("th",{className:"px-3 py-2",children:"Montant"}),(0,n.jsx)("th",{className:"px-3 py-2",children:"Statut"}),(0,n.jsx)("th",{className:"px-3 py-2",children:"D\xe9but"}),(0,n.jsx)("th",{className:"px-3 py-2",children:"Fin"}),(0,n.jsx)("th",{className:"px-3 py-2",children:"Actions"})]})}),(0,n.jsx)("tbody",{children:u?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:7,className:"text-center p-4",children:"Chargement..."})}):0===C.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:7,className:"text-center p-4",children:"Aucun abonnement"})}):C.map(e=>{var t,a,s;return(0,n.jsxs)("tr",{className:"border-b",children:[(0,n.jsx)("td",{className:"px-3 py-2",children:(null==(t=e.client)?void 0:t.name)||"-"}),(0,n.jsx)("td",{className:"px-3 py-2",children:e.plan}),(0,n.jsxs)("td",{className:"px-3 py-2",children:[e.amount," ",e.currency]}),(0,n.jsx)("td",{className:"px-3 py-2",children:e.status}),(0,n.jsx)("td",{className:"px-3 py-2",children:(null==(a=e.startDate)?void 0:a.slice(0,10))||"-"}),(0,n.jsx)("td",{className:"px-3 py-2",children:(null==(s=e.endDate)?void 0:s.slice(0,10))||"-"}),(0,n.jsxs)("td",{className:"px-3 py-2 flex gap-2",children:[(0,n.jsx)("button",{className:"bg-yellow-500 text-white px-2 py-1 rounded",onClick:()=>f(e.id,"EXPIRED"),children:"Expirer"}),(0,n.jsx)("button",{className:"bg-green-600 text-white px-2 py-1 rounded",onClick:()=>f(e.id,"ACTIVE"),children:"Activer"}),(0,n.jsx)("button",{className:"bg-red-600 text-white px-2 py-1 rounded",onClick:()=>w(e.id),children:"Supprimer"})]})]},e.id)})})]})}),x&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-md",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Ajouter un abonnement"}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),v()},className:"flex flex-col gap-2",children:[(0,n.jsxs)("select",{value:m.clientId||"",onChange:e=>y(t=>({...t,clientId:e.target.value})),required:!0,className:"border px-2 py-1 rounded",children:[(0,n.jsx)("option",{value:"",children:"S\xe9lectionner un client"}),a.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,n.jsx)("input",{type:"text",placeholder:"Plan (mensuel, annuel...)",value:m.plan||"",onChange:e=>y(t=>({...t,plan:e.target.value})),required:!0,className:"border px-2 py-1 rounded"}),(0,n.jsx)("input",{type:"number",placeholder:"Montant",value:m.amount||"",onChange:e=>y(t=>({...t,amount:Number(e.target.value)})),required:!0,className:"border px-2 py-1 rounded"}),(0,n.jsx)("input",{type:"text",placeholder:"Devise (EUR, USD...)",value:m.currency||"",onChange:e=>y(t=>({...t,currency:e.target.value})),className:"border px-2 py-1 rounded"}),(0,n.jsx)("input",{type:"date",placeholder:"Date de d\xe9but",value:m.startDate||"",onChange:e=>y(t=>({...t,startDate:e.target.value})),className:"border px-2 py-1 rounded"}),(0,n.jsx)("input",{type:"date",placeholder:"Date de fin",value:m.endDate||"",onChange:e=>y(t=>({...t,endDate:e.target.value})),className:"border px-2 py-1 rounded"}),(0,n.jsx)("input",{type:"text",placeholder:"Cycle de facturation (mensuel, annuel...)",value:m.billingCycle||"",onChange:e=>y(t=>({...t,billingCycle:e.target.value})),className:"border px-2 py-1 rounded"}),(0,n.jsx)("input",{type:"text",placeholder:"M\xe9thode de paiement",value:m.paymentMethod||"",onChange:e=>y(t=>({...t,paymentMethod:e.target.value})),className:"border px-2 py-1 rounded"}),(0,n.jsx)("textarea",{placeholder:"Notes",value:m.notes||"",onChange:e=>y(t=>({...t,notes:e.target.value})),className:"border px-2 py-1 rounded"}),(0,n.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Ajouter"}),(0,n.jsx)("button",{type:"button",className:"bg-gray-400 text-white px-4 py-2 rounded",onClick:()=>h(!1),children:"Annuler"})]})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8441,1684,7358],()=>t(1413)),_N_E=e.O()}]);