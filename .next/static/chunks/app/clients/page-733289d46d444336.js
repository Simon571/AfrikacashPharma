(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5021],{232:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},2903:(e,t,s)=>{Promise.resolve().then(s.bind(s,8373))},3904:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},5339:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},7580:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},8373:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var a=s(5155),l=s(2115),r=s(3904),n=s(7580),i=s(9946);let c=(0,i.A)("badge-check",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),d=(0,i.A)("circle-slash-2",[["path",{d:"M22 2 2 22",key:"y4kqgn"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var o=s(232);let m=(0,i.A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);var x=s(5339),h=s(8883),u=s(9420);async function p(){return(await fetch("/api/admin/clients",{credentials:"include"})).json()}let f={ACTIVE:"Actif",SUSPENDED:"Suspendu",PENDING:"En attente"},g={ACTIVE:"bg-emerald-50 text-emerald-600 ring-emerald-500/20",SUSPENDED:"bg-rose-50 text-rose-600 ring-rose-500/20",PENDING:"bg-amber-50 text-amber-600 ring-amber-500/20"};function b(){let[e,t]=(0,l.useState)([]),[s,i]=(0,l.useState)(!0),[b,j]=(0,l.useState)(null),[N,v]=(0,l.useState)(""),[w,k]=(0,l.useState)(null),[A,C]=(0,l.useState)(!1),[E,S]=(0,l.useState)(null),T=(0,l.useCallback)(async()=>{i(!0),j(null);try{let e=await p();if(e.error)return void j(e.error||"Erreur lors de la r\xe9cup\xe9ration");t(e.clients||[])}catch(e){j(e instanceof Error?e.message:String(e))}finally{i(!1)}},[]);(0,l.useEffect)(()=>{T()},[T]);let L=(0,l.useMemo)(()=>{let t=e.length,s=e.filter(e=>"ACTIVE"===e.status).length;return{total:t,active:s,suspended:e.filter(e=>"SUSPENDED"===e.status).length,noLicense:e.filter(e=>!e.license).length}},[e]),I=(0,l.useMemo)(()=>{let t=N.trim().toLowerCase();return[...e].sort((e,t)=>{let s=e.license&&"ACTIVE"===e.license.status?0:1,a=t.license&&"ACTIVE"===t.license.status?0:1;return s!==a?s-a:e.name.localeCompare(t.name)}).filter(e=>(!w||e.status===w)&&(!t||e.name.toLowerCase().includes(t)||(e.contactEmail||"").toLowerCase().includes(t)||(e.contactPhone||"").toLowerCase().includes(t)))},[e,N,w]),P=(0,l.useCallback)(async()=>{C(!0);try{let e=await p();e.error?S({type:"error",message:e.error}):(t(e.clients||[]),S({type:"success",message:"Liste synchronis\xe9e"}))}catch(e){S({type:"error",message:e instanceof Error?e.message:String(e)})}finally{C(!1),setTimeout(()=>S(null),3500)}},[]),M=(0,l.useCallback)(async e=>{try{let s=await fetch("/api/admin/licenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:e})}),a=await s.json();if(a.key){S({type:"success",message:"Licence g\xe9n\xe9r\xe9e : ".concat(a.key)});let e=await p();t(e.clients||[])}else throw Error(a.error||"\xc9chec g\xe9n\xe9ration licence")}catch(e){S({type:"error",message:e instanceof Error?e.message:String(e)})}finally{setTimeout(()=>S(null),5e3)}},[]),D=(0,l.useCallback)(async(e,s)=>{try{let a="ACTIVE"===s?"suspend":"activate",l=await fetch("/api/admin/clients",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:e,action:a})}),r=await l.json();if(r.client)t(e=>e.map(e=>e.id===r.client.id?r.client:e)),S({type:"success",message:"Client ".concat("suspend"===a?"suspendu":"activ\xe9")});else throw Error(r.error||"Action impossible")}catch(e){S({type:"error",message:e instanceof Error?e.message:String(e)})}finally{setTimeout(()=>S(null),4e3)}},[]),V=(0,l.useCallback)(async e=>{if(confirm("Supprimer ce client ? Cette action est irr\xe9versible."))try{let s=await fetch("/api/admin/clients?clientId=".concat(e),{method:"DELETE"}),a=await s.json();if(a.ok)t(t=>t.filter(t=>t.id!==e)),S({type:"success",message:"Client supprim\xe9"});else throw Error(a.error||"Suppression impossible")}catch(e){S({type:"error",message:e instanceof Error?e.message:String(e)})}finally{setTimeout(()=>S(null),4e3)}},[]);return(0,a.jsx)("main",{className:"mx-auto max-w-6xl px-4 pb-12 pt-10",children:(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("header",{className:"flex flex-col gap-4 md:flex-row md:items-end md:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold uppercase tracking-wide text-emerald-400",children:"Gestion de l'\xe9quipe"}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100",children:"Clients & acc\xe8s"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-slate-500",children:"Surveillez l'adoption de la plateforme, pilotez les licences et ajustez les statuts en quelques clics."})]}),(0,a.jsxs)("button",{onClick:()=>void P(),disabled:A,className:"inline-flex items-center justify-center gap-2 rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md disabled:cursor-not-allowed disabled:opacity-70",children:[(0,a.jsx)(r.A,{className:"h-4 w-4 ".concat(A?"animate-spin":"")}),"Actualiser"]})]}),(0,a.jsxs)("section",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsx)(y,{icon:n.A,label:"Clients",value:L.total,description:"R\xe9f\xe9renc\xe9s"}),(0,a.jsx)(y,{icon:c,label:"Actifs",value:L.active,description:"Avec acc\xe8s",highlight:!0}),(0,a.jsx)(y,{icon:d,label:"Suspendus",value:L.suspended,description:"Acc\xe8s coup\xe9",variant:"warning"}),(0,a.jsx)(y,{icon:o.A,label:"Sans licence",value:L.noLicense,description:"\xc0 activer",variant:"info"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 rounded-xl border border-slate-200 bg-white/80 p-4 shadow-sm backdrop-blur",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{className:"relative w-full md:w-80",children:[(0,a.jsx)(m,{className:"pointer-events-none absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),(0,a.jsx)("input",{value:N,onChange:e=>v(e.target.value),placeholder:"Rechercher par nom, email ou t\xe9l\xe9phone",className:"w-full rounded-lg border border-slate-200 bg-white py-2 pl-10 pr-3 text-sm text-slate-700 shadow-inner focus:border-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-100"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[["ACTIVE","SUSPENDED","PENDING"].map(e=>{var t;return(0,a.jsxs)("button",{onClick:()=>k(t=>t===e?null:e),className:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-semibold transition ".concat(w===e?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-slate-200 bg-white text-slate-500 hover:border-emerald-200 hover:bg-emerald-50 hover:text-emerald-700"),children:[(0,a.jsx)("span",{className:"h-2 w-2 rounded-full bg-current"}),null!=(t=f[e])?t:e]},e)}),w&&(0,a.jsx)("button",{onClick:()=>k(null),className:"text-xs font-medium text-slate-500 underline transition hover:text-slate-700",children:"R\xe9initialiser"})]})]}),E&&(0,a.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2 text-sm ".concat("success"===E.type?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-rose-200 bg-rose-50 text-rose-700"),children:["success"===E.type?(0,a.jsx)(c,{className:"h-4 w-4"}):(0,a.jsx)(x.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:E.message})]}),(0,a.jsx)("div",{className:"overflow-hidden rounded-xl border border-slate-100",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-slate-100",children:[(0,a.jsx)("thead",{className:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left",children:"Client"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left",children:"Contact"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left",children:"Licence"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left",children:"Statut"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-100 text-sm text-slate-600",children:s?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"px-4 py-10 text-center text-slate-400",children:"Chargement des clientsâ€¦"})}):b?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"px-4 py-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-rose-600",children:[(0,a.jsx)(x.A,{className:"h-4 w-4"}),b]})})}):0===I.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"px-4 py-10 text-center text-slate-400",children:"Aucun client ne correspond \xe0 votre recherche."})}):I.map(e=>{var t,s,l;let r=null!=(s=g[e.status])?s:"bg-slate-100 text-slate-600 ring-slate-500/10",n=(null==(t=e.license)?void 0:t.status)==="ACTIVE";return(0,a.jsxs)("tr",{className:"hover:bg-slate-50/60",children:[(0,a.jsx)("td",{className:"px-4 py-4 font-medium text-slate-900",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-full text-sm font-semibold text-white ".concat(n?"bg-emerald-500":"bg-slate-400"),children:e.name.slice(0,2).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:["Identifiant : ",e.id]})]})]})}),(0,a.jsx)("td",{className:"px-4 py-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-1 text-xs",children:[e.contactEmail?(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 text-slate-600",children:[(0,a.jsx)(h.A,{className:"h-3.5 w-3.5"}),e.contactEmail]}):(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 text-slate-400",children:[(0,a.jsx)(h.A,{className:"h-3.5 w-3.5"}),"Pas d'email"]}),e.contactPhone?(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 text-slate-600",children:[(0,a.jsx)(u.A,{className:"h-3.5 w-3.5"}),e.contactPhone]}):(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 text-slate-400",children:[(0,a.jsx)(u.A,{className:"h-3.5 w-3.5"}),"Pas de t\xe9l\xe9phone"]})]})}),(0,a.jsx)("td",{className:"px-4 py-4",children:e.license?(0,a.jsx)("span",{className:"inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold ".concat("ACTIVE"===e.license.status?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-500/20":"bg-amber-50 text-amber-600 ring-1 ring-amber-500/20"),children:"ACTIVE"===e.license.status?"Active":e.license.status}):(0,a.jsxs)("button",{onClick:()=>void M(e.id),className:"inline-flex items-center gap-2 rounded-full border border-dashed border-emerald-300 px-3 py-1 text-xs font-semibold text-emerald-600 transition hover:border-emerald-500 hover:bg-emerald-50",children:[(0,a.jsx)(o.A,{className:"h-3.5 w-3.5"}),"G\xe9n\xe9rer"]})}),(0,a.jsx)("td",{className:"px-4 py-4",children:(0,a.jsxs)("span",{className:"inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold ring-1 ".concat(r),children:[(0,a.jsx)("span",{className:"h-2 w-2 rounded-full bg-current"}),null!=(l=f[e.status])?l:e.status]})}),(0,a.jsx)("td",{className:"px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 text-xs font-semibold",children:[(0,a.jsx)("button",{onClick:()=>void D(e.id,e.status),className:"rounded-lg border border-slate-200 px-3 py-1.5 text-slate-600 transition hover:border-emerald-300 hover:text-emerald-600",children:"ACTIVE"===e.status?"Suspendre":"Activer"}),(0,a.jsx)("button",{onClick:()=>void M(e.id),className:"rounded-lg border border-emerald-300 bg-emerald-500/10 px-3 py-1.5 text-emerald-600 transition hover:bg-emerald-500/20",children:"Licence"}),(0,a.jsx)("button",{onClick:()=>void V(e.id),className:"rounded-lg border border-transparent px-3 py-1.5 text-rose-600 transition hover:bg-rose-50",children:"Supprimer"})]})})]},e.id)})})]})})]})]})})}function y(e){let{icon:t,label:s,value:l,description:r,highlight:n,variant:i}=e;return(0,a.jsxs)("article",{className:"".concat("rounded-xl border p-4 shadow-sm transition hover:-translate-y-0.5 hover:shadow-md"," ").concat(n?"border-emerald-200 bg-gradient-to-br from-emerald-50 to-white":"warning"===i?"border-amber-200 bg-amber-50/60":"info"===i?"border-sky-200 bg-sky-50/60":"border-slate-200 bg-white"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:s}),(0,a.jsx)("p",{className:"mt-2 text-3xl font-bold text-slate-900",children:l})]}),(0,a.jsx)("div",{className:"rounded-full bg-slate-900/10 p-2 text-slate-700",children:(0,a.jsx)(t,{className:"h-5 w-5"})})]}),(0,a.jsx)("p",{className:"mt-3 text-xs text-slate-500",children:r})]})}},8883:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},9420:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]])},9946:(e,t,s)=>{"use strict";s.d(t,{A:()=>m});var a=s(2115);let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),r=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),n=e=>{let t=r(e);return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()},c=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,a.forwardRef)((e,t)=>{let{color:s="currentColor",size:l=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:o="",children:m,iconNode:x,...h}=e;return(0,a.createElement)("svg",{ref:t,...d,width:l,height:l,stroke:s,strokeWidth:n?24*Number(r)/Number(l):r,className:i("lucide",o),...!m&&!c(h)&&{"aria-hidden":"true"},...h},[...x.map(e=>{let[t,s]=e;return(0,a.createElement)(t,s)}),...Array.isArray(m)?m:[m]])}),m=(e,t)=>{let s=(0,a.forwardRef)((s,r)=>{let{className:c,...d}=s;return(0,a.createElement)(o,{ref:r,iconNode:t,className:i("lucide-".concat(l(n(e))),"lucide-".concat(e),c),...d})});return s.displayName=n(e),s}}},e=>{var t=t=>e(e.s=t);e.O(0,[8441,1684,7358],()=>t(2903)),_N_E=e.O()}]);